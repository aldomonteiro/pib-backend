{"version":3,"sources":["../../../src/api/bot/actionsController.js"],"names":["QTY_1","getFlavorsAndToppings","pageID","flavorArray","i","length","flavor","toppings","toppingArray","toppingsNames","console","log","inputCardapioReplyMsg","replyMsg","k","toppingObj","topping","replace","getOpenAndClose","weekDay","Date","getDay","openingTimes","openAndClose","isOpen","openTime","closeTime","mon_is_open","mon_open","mon_close","tue_is_open","tue_open","tue_close","wed_is_open","wed_open","wed_close","thu_is_open","thu_open","thu_close","fri_is_open","fri_open","fri_close","sat_is_open","sat_open","sat_close","sun_is_open","sun_open","sun_close","inputHorarioReplyMsg","strOpenTime","getHours","getMinutes","toString","padStart","strCloseTime","validateBotOrder","entities","quantidade","tamanho","produto","sabor","validated","basicValidation","replyText","String","order_flavor","order_qty","order_size","order_prod","order_flav","concat"],"mappings":"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","sourcesContent":["import { getFlavors, getFlavorByName } from \"../controllers/flavorsController\";\nimport { getToppings } from \"../controllers/toppingsController\";\nimport { getOpeningTimes } from '../controllers/storesController';\n\nconst QTY_1 = [1, \"um\", \"uma\"];\n\nexport const getFlavorsAndToppings = async (pageID) => {\n    try {\n        const flavorArray = await getFlavors(pageID);\n        for (let i = 0; i < flavorArray.length; i++) {\n            const flavor = flavorArray[i];\n            const toppingArray = await getToppings(flavor.toppings);\n            flavorArray[i].toppingsNames = toppingArray;\n        }\n        return flavorArray;\n    } catch (err) {\n        console.log(\"err on getFlavorsAndToppings\");\n        console.log(err);\n    }\n}\n\nexport const inputCardapioReplyMsg = (flavorArray) => {\n    let replyMsg = '';\n    if (flavorArray) {\n        for (let i = 0; i < flavorArray.length; i++) {\n            const flavor = flavorArray[i];\n            replyMsg = replyMsg + '*' + flavor.flavor + '*' + '\\n';\n            const toppingArray = flavor.toppingsNames;\n            if (toppingArray) {\n                for (let k = 0; k < toppingArray.length; k++) {\n                    const toppingObj = toppingArray[k];\n                    if (k < toppingArray.length - 1)\n                        replyMsg = replyMsg + toppingObj.topping + ', ';\n                    else {\n                        replyMsg = replyMsg.replace(/, $/, ' e '); // replace the last comma\n                        replyMsg = replyMsg + toppingObj.topping;\n                    }\n                }\n                replyMsg = replyMsg + '\\n';\n            }\n        }\n    }\n    return replyMsg;\n}\n\nexport const getOpenAndClose = async (pageID) => {\n    // TODO: timezone from the store\n    const weekDay = (new Date()).getDay();\n\n    const openingTimes = await getOpeningTimes(pageID);\n\n    if (openingTimes) {\n        let openAndClose = { isOpen: false, openTime: null, closeTime: null };\n        if (weekDay === 1) {\n            openAndClose.isOpen = openingTimes.mon_is_open;\n            openAndClose.openTime = openingTimes.mon_open;\n            openAndClose.closeTime = openingTimes.mon_close;\n        } else if (weekDay === 2) {\n            openAndClose.isOpen = openingTimes.tue_is_open;\n            openAndClose.openTime = openingTimes.tue_open;\n            openAndClose.closeTime = openingTimes.tue_close;\n        } else if (weekDay === 3) {\n            openAndClose.isOpen = openingTimes.wed_is_open;\n            openAndClose.openTime = openingTimes.wed_open;\n            openAndClose.closeTime = openingTimes.wed_close;\n        } else if (weekDay === 4) {\n            openAndClose.isOpen = openingTimes.thu_is_open;\n            openAndClose.openTime = openingTimes.thu_open;\n            openAndClose.closeTime = openingTimes.thu_close;\n        } else if (weekDay === 5) {\n            openAndClose.isOpen = openingTimes.fri_is_open;\n            openAndClose.openTime = openingTimes.fri_open;\n            openAndClose.closeTime = openingTimes.fri_close;\n        } else if (weekDay === 6) {\n            openAndClose.isOpen = openingTimes.sat_is_open;\n            openAndClose.openTime = openingTimes.sat_open;\n            openAndClose.closeTime = openingTimes.sat_close;\n        }\n        else if (weekDay === 7) {\n            openAndClose.isOpen = openingTimes.sun_is_open;\n            openAndClose.openTime = openingTimes.sun_open;\n            openAndClose.closeTime = openingTimes.sun_close;\n        }\n        return openAndClose;\n    }\n    return null;\n}\n\nexport const inputHorarioReplyMsg = (openAndClose) => {\n    let replyMsg = '';\n    if (openAndClose) {\n        if (openAndClose.isOpen === true) {\n            const strOpenTime = new Date(openAndClose.openTime).getHours() + ':' + new Date(openAndClose.openTime).getMinutes().toString().padStart(2, '0');\n            const strCloseTime = new Date(openAndClose.closeTime).getHours() + ':' + new Date(openAndClose.closeTime).getMinutes().toString().padStart(2, '0');\n\n            replyMsg = 'Olá, hoje nosso horário de funcionamento é a partir das ';\n            replyMsg = replyMsg + strOpenTime + ' horas, até às ';\n            replyMsg = replyMsg + strCloseTime + ' horas.';\n        } else {\n            replyMsg = 'Olá, infelizmente hoje estamos fechados, então, não estamos aceitando pedidos. ';\n        }\n    }\n    return replyMsg;\n}\n\n/**\n * validateBotOrder\n * @param {*} pageID \n * @param {*} entities \n * @return\n */\nexport const validateBotOrder = async (pageID, entities) => {\n    const { quantidade, tamanho, produto, sabor } = entities;\n    const validated = basicValidation(quantidade, tamanho, produto, sabor);\n    var replyText = new String();\n    if (validated === 0) { // passed\n        const order_flavor = await getFlavorByName(pageID, sabor[0]);\n\n        if (order_flavor) {\n            const order_qty = quantidade[0];\n            const order_size = tamanho[0];\n            const order_prod = produto.length > 0 ? produto[0] : 'pizza';\n            const order_flav = order_flavor.flavor;\n\n            replyText = 'Ok, o seu pedido é : \\n';\n            replyText = replyText.concat(order_qty, ' ', order_prod, ' ', order_size, ' de ', order_flav, '\\n');\n            replyText = replyText.concat('Para confirmar, digite SIM. Se tem algum problema, diga pra mim o que está errado');\n        } else {\n            replyText = 'Não temos o sabor ' + sabor[0];\n        }\n    } else if (validated === 1) {\n        replyText = 'A quantidade solicitada não bate, vou questionar se está faltando algo...';\n    } else {\n        replyText = 'Algum problema com tamanho ou sabor...';\n    }\n    return replyText;\n}\n\n/**\n * basicValidation\n * @param {*} quantidade \n * @param {*} tamanho \n * @param {*} produto \n * @param {*} sabor \n * @returns\n *      0 - if the validation passed\n *      1 - if quantidade validation failed\n *      2 - if tamanho validation failed\n *      3 - if produto validation failed\n *      4 - if sabor validation failed\n */\nconst basicValidation = (quantidade, tamanho, produto, sabor) => {\n    // 1 pizza, 1 sabor, 1 quantidade\n    if (quantidade.length === 1) { // && QTY_1.includes(quantidade[1])) {\n        if (tamanho.length === 1) {\n            if (sabor.length === 1) {\n                return 0;\n            }\n        }\n    }\n    return 5;\n}\n\n\n"],"file":"actionsController.js"}