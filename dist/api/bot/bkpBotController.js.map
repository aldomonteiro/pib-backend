{"version":3,"sources":["../../../src/api/bot/bkpBotController.js"],"names":["log_file","fs","createWriteStream","__dirname","flags","log_stdout","process","stdout","console","log","d","write","util","format","MSG_GENERAL_ERROR","sendErrorMsg","_errorMsg","out","Elements","_showErrorMsg","add","text","basicReply","replyText","type","askForContinue","pageId","userId","options","data","event","checkLastAction","pendingOrder","order","waitingFor","addrData","confirmAddress","askForLocation","location","lat","location_lat","location_long","url","location_url","confirmLocationAddress","askForSize","askForQuantity","askForSplitFlavorOrConfirm","askForFlavor","askForWantBeverage","askForBeverages","showFullOrder","showOrderOrNextItem","sendMainMenu","optionsStopOrder","_txt","replies","QuickReplies","setQuickReplies","passThreadControl","result","sendWelcomeMessage","pageID","sender","fetch","page","replyMsg","String","firstResponseText","replace","first_name","sendHorario","todayIsOpen","todayOpenAt","todayCloseAt","sendCardapio","askForWantOrder","user","isLocation","addresses","length","setListStyle","foundAnyCompleteAddress","i","element","address_components","_data","formatted_address","buttons","Buttons","addressNumber","subtext","buttonsOpt","isOnlyButtons","askToTypeAddress","confirmAddressOrAskLocation","userID","waitingForAddress","_replyText","formattedAddress","showAddress","formattedAddrData","showOrderOrAskForPhone","isComplete","po","askForPhone","isPhoneNumber","askToTypePhone","confirmTypedPhone","phone","showPhone","askForQuantityMore","showQuantity","qty","substr","currentItem","_text","qty_total","sizesWithPricing","sizes","id","size","split","eraseSplit","showSize","sizeId","multiple","currentItemSize","currentSize","askForFlavorOrConfirm","showSplit","originalSplit","_txtFlavor","inputCardapioReplyMsg","flavorArray","flavor","toppingsNames","join","getFlavorsAndToppings","sizeID","flavorsWithPrice","Array","getOnePricing","kind","pricing","price","toppings","push","error","flavorsAndToppingsErr","items","status","flavorId","_id","flavorsArray","_rangeIni","_rangeEnd","_fl","_subtext","concat","option","showFlavor","completeItem","calcTotal","currentItemSplit","item_complete","nextItem","total_price","_item","_txtQty","beverageId","beverage","address","askForPaymentType","showPaymentType","paymentType","_txtPaymentType","askForPaymentChange","showPaymentChange","paymentChange","_txtPaymentChange","payment_type","payment_change","confirmOrder","askForChangeOrder","askForOptionsToChange","item","askForOptionsToChangeErr","askForSpecificItem","forEach","noBeverage","no_beverage","beveragesArr","_bev","name","showNoBeverage","showBeverage","beveragePrice","updateItemAskOptions","objectId","sendShippingNotification","orderId","accessToken","Bot","send_message_tag","sendRejectionNotification","rejectionExplanation"],"mappings":"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","sourcesContent":["import util from 'util';\nimport fs from 'fs';\nimport { Bot, Elements, Buttons, QuickReplies } from 'facebook-messenger-bot';\nimport { getOnePageToken, getOnePageData, sendPassThreadControl } from '../controllers/pagesController';\nimport { getPricingSizing } from '../controllers/pricingsController';\nimport { getFlavors } from \"../controllers/flavorsController\";\nimport { getToppingsNames } from \"../controllers/toppingsController\";\nimport getCardapio from './show_cardapio';\nimport { getSizes, getSize } from '../controllers/sizesController';\nimport { getBeverages } from '../controllers/beveragesController';\nimport { getTodayOpeningTime } from '../controllers/storesController';\nimport { updateOrder, getOrderPending } from '../controllers/ordersController';\nimport { getAddressLocation, getCustomerAddress, formatAddrData } from '../controllers/customersController';\nimport { updateStatusSpecificItem } from '../controllers/itemsController';\n\n// TODO: create a debugger with json format\nvar log_file = fs.createWriteStream(__dirname + '/debug.log', { flags: 'w' });\nvar log_stdout = process.stdout;\n\nconsole.log = function (d) { //\n    log_file.write(util.format(d) + '\\n');\n    log_stdout.write(util.format(d) + '\\n');\n};\n\nconst MSG_GENERAL_ERROR = 'Ops, estamos com um probleminha tcnico: ';\n\n// // create a custom timestamp format for log statements\n// const SimpleNodeLogger = require('simple-node-logger'),\n//     opts = {\n//         logFilePath: 'logs/bot.log',\n//         timestampFormat: 'YYYY-MM-DD HH:mm:ss.SSS'\n//     },\n//     log = SimpleNodeLogger.createSimpleLogger(opts);\n\nexport const sendErrorMsg = async (_errorMsg) => {\n    const out = new Elements();\n    let _showErrorMsg = _errorMsg ? _errorMsg : 'ERRO DESCONHECIDO';\n    out.add({ text: MSG_GENERAL_ERROR + _showErrorMsg });\n    return out;\n}\n\n// export const updateOrderFlow = async (pageID, userID) => {\n\n// }\n\nexport const basicReply = async (replyText) => {\n    if (!replyText) {\n        replyText = 'Hi, how are you doing?';\n    }\n    return { type: 'text', text: replyText };\n}\n\n/**\n * Send Yes or No to the user asking if he wants to place an order right now.\n * @param {*} pageId \n * @param {*} userId \n */\nexport const askForContinue = async (pageId, userId) => {\n    return {\n        type: 'replies',\n        text: 'No entendi o que voc quis dizer. . Vamos continuar com o pedido?',\n        options: [\n            { text: \"Sim\", data: \"continueorder_yes\", event: 'ORDER_CONTINUE_ORDER' },\n            { text: \"No\", data: \"continueorder_no\", event: 'ORDER_CONTINUE_ORDER' }\n        ]\n    }\n}\n\nexport const checkLastAction = async (pageId, userId) => {\n\n    const pendingOrder = await getOrderPending({ pageId, userId });\n\n    if (pendingOrder.order) {\n        if (pendingOrder.order.waitingFor === 'confirm_address') {\n            const addrData = await getCustomerAddress(pageId, userId);\n            return await confirmAddress(pageId, userId, addrData);\n        }\n        else if (pendingOrder.order.waitingFor === 'location')\n            return await askForLocation(pageId, userId);\n        else if (pendingOrder.order.waitingFor === 'location_address') {\n            const location = {\n                lat: pendingOrder.order.location_lat,\n                long: pendingOrder.order.location_long,\n                url: pendingOrder.order.location_url,\n            }\n            return await confirmLocationAddress(pageId, userId, location);\n        }\n        else if (pendingOrder.order.waitingFor === 'size')\n            return await askForSize(pageId, userId)\n        else if (pendingOrder.order.waitingFor === 'quantity')\n            return await askForQuantity(pageId, userId);\n        else if (pendingOrder.order.waitingFor === 'split')\n            return askForSplitFlavorOrConfirm(pageId, userId, 1);\n        else if (pendingOrder.order.waitingFor === 'flavor')\n            return await askForFlavor(pageId, userId, 1);\n        else if (pendingOrder.order.waitingFor === 'want_beverage')\n            return await askForWantBeverage(pageId, userId);\n        else if (pendingOrder.order.waitingFor === 'beverage')\n            return await askForBeverages(pageId, userId, 1);\n        else if (pendingOrder.order.waitingFor === 'confirmation')\n            return await showFullOrder(pageId, userId);\n        else if (pendingOrder.order.waitingFor === 'nothing')\n            return await showOrderOrNextItem(pageId, userId);\n        else\n            return await sendMainMenu();\n    } else\n        return await sendMainMenu();\n}\n\nexport const optionsStopOrder = async (pageId, userId) => {\n    const out = new Elements();\n    let _txt = 'Muito bem, aqui esto as opes:';\n    out.add({ text: _txt });\n\n    const replies = new QuickReplies();\n    // replies.add({ text: \"Quantidade\", data: \"change_quantity\", event: 'ORDER_CHANGE' });\n    replies.add({ text: \"Voltar p/ Incio\", data: \"stoporder_init\", event: 'STOP_ORDER_OPTIONS' });\n    replies.add({ text: \"Falar c/ Humano\", data: \"stoporder_human\", event: 'STOP_ORDER_OPTIONS' });\n    out.setQuickReplies(replies);\n    return out;\n}\n\nexport const passThreadControl = async (pageId, userId) => {\n    const out = new Elements();\n\n    const result = await sendPassThreadControl(pageId, userId);\n    if (result === 200) {\n        let _txt = 'Ok, a partir de agora voc est nas mos do nosso humano. \\\n    O que voc escrever a partir de agora ser respondido por uma pessoa, \\\n    o mais rpido possvel!';\n        out.add({ text: _txt });\n    } else {\n        let _txt = 'Ops, tivemos um probleminha. Tente novamente';\n        out.add({ text: _txt });\n    }\n    return out;\n}\n\n\n/**\n * \n * @param {*} sender \n * @param {*} pageID \n */\nexport const sendWelcomeMessage = async (pageID, sender) => {\n    await sender.fetch('first_name');\n    const page = await getOnePageData(pageID);\n    const replyMsg = new String(page.firstResponseText).replace('$NAME', sender.first_name);\n    const out = new Elements();\n    out.add({ text: replyMsg });\n    return out;\n}\n\nexport const sendMainMenu = async () => {\n    return {\n        type: 'buttons',\n        text: 'Por favor escolha uma das opes',\n        options: [\n            { text: ' Cardpio', data: 'CARDAPIO_PAYLOAD', event: 'MAIN-MENU' },\n            { text: ' Horrios', data: 'HORARIO_PAYLOAD', event: 'MAIN-MENU' },\n            { text: ' Fazer Pedido', data: 'PEDIDO_PAYLOAD', event: 'MAIN-MENU' }\n        ]\n    };\n\n    // const buttons = new Buttons();\n    // buttons.add({ text: ' Cardpio', data: 'CARDAPIO_PAYLOAD', event: 'MAIN-MENU' });\n    // buttons.add({ text: ' Horrios', data: 'HORARIO_PAYLOAD', event: 'MAIN-MENU' });\n    // buttons.add({ text: ' Fazer Pedido', data: 'PEDIDO_PAYLOAD', event: 'MAIN-MENU' });\n\n    // const out = new Elements();\n    // out.add({ text: 'Por favor escolha uma das opes', buttons });\n\n    // return out;\n}\n\nexport const sendHorario = async (pageID) => {\n    const { todayIsOpen, todayOpenAt, todayCloseAt } = await getTodayOpeningTime(pageID);\n\n    let replyMsg = '';\n    if (todayIsOpen === true) {\n        replyMsg = 'Estamos abertos hoje, a partir das ' + todayOpenAt + ' horas, at s ' + todayCloseAt + ' horas.';\n    } else {\n        replyMsg = 'Infelizmente hoje no estamos abertos, mas voc pode consultar nosso cardpio no menu principal.';\n    }\n    return { type: 'text', text: replyMsg };\n}\n\n/**\n * Returns only the formatted text to be sent to the user\n * @param {*} pageID \n */\nexport const sendCardapio = async (pageID) => {\n    const replyMsg = await getCardapio(pageID);\n    return { type: 'text', text: replyMsg };\n\n    // const out = new Elements();\n    // out.add({ text: replyMsg });\n\n    // return out;\n}\n\n/**\n * Send Yes or No to the user asking if he wants to place an order right now.\n */\nexport const askForWantOrder = async () => {\n    return {\n        type: 'replies',\n        text: 'Agora que voc viu nosso cardpio, voc est pronto para fazer o pedido?',\n        options: [\n            { text: \"Sim\", data: \"wantorder_yes\", event: 'ORDER_WANT_ORDER' },\n            { text: \"No\", data: \"wantorder_no\", event: 'ORDER_WANT_ORDER' }\n        ]\n    };\n\n    // const out = new Elements();\n    // let _txt = 'Agora que voc viu nosso cardpio, voc est pronto para fazer o pedido?';\n    // out.add({ text: _txt });\n\n    // const replies = new QuickReplies();\n    // // replies.add({ text: \"Quantidade\", data: \"change_quantity\", event: 'ORDER_CHANGE' });\n    // replies.add({ text: \"Sim\", data: \"wantorder_yes\", event: 'ORDER_WANT_ORDER' });\n    // replies.add({ text: \"No\", data: \"wantorder_no\", event: 'ORDER_WANT_ORDER' });\n    // out.setQuickReplies(replies);\n    // return out;\n}\n\n\n/**\n * Question No.01\n * If the user doesnt have an address in the database, this will be the first question.\n */\nexport const askForLocation = async (pageId, userId, user) => {\n    await updateOrder({ pageId, userId, user, waitingFor: 'location' });\n\n    const out = new Elements();\n    out.add({ text: 'Para comear, preciso saber aonde voc est. Clique no boto abaixo que receberei a sua localizao.' });\n\n    const replies = new QuickReplies();\n    replies.add({ text: 'Localizao', isLocation: true, data: 'location_location', event: 'LOCATION' });\n    // replies.add({ text: 'Informar o CEP', data: 'location_cep', event: 'LOCATION' });\n    out.setQuickReplies(replies);\n    return out;\n}\n\nexport const confirmLocationAddress = async (pageId, userId, location, user) => {\n\n    await updateOrder({ pageId, userId, location, user, waitingFor: 'location_address' });\n\n    const addresses = await getAddressLocation(location);\n\n    if (addresses && addresses.length && addresses.length > 0) {\n\n        const out = new Elements();\n        out.setListStyle('compact');\n\n        let foundAnyCompleteAddress = false;\n        for (let i = 0; i < 4; i++) {\n            const element = addresses[i];\n            if (element.address_components && element.address_components.length >= 6) {\n                foundAnyCompleteAddress = true;\n                const _data = { formatted_address: element.formatted_address, address_components: element.address_components };\n                const buttons = new Buttons();\n                buttons.add({ text: 'Esse!', data: _data, event: 'LOCATION_ADDRESS' });\n                let addressNumber = i + 1;\n                out.add({ text: 'Endereo ' + addressNumber, subtext: element.formatted_address, buttons });\n            }\n        }\n\n        if (foundAnyCompleteAddress) {\n            const buttonsOpt = new Buttons();\n            buttonsOpt.add({ text: 'No  meu endereo..', data: \"incorrect_address\", event: 'LOCATION_ADDRESS' });\n            out.add({ buttons: buttonsOpt, isOnlyButtons: true });\n            return out;\n        } else {\n            return await askToTypeAddress(pageId, userId);\n        }\n    }\n    else {\n        return await askToTypeAddress(pageId, userId);\n    }\n}\n\nexport const confirmAddressOrAskLocation = async (pageId, userId, user) => {\n\n    // TODO: check if the location is in the neighborhood.\n    // TODO: check if the location is the same as stored in db.\n    const addrData = await getCustomerAddress(pageId, userId);\n\n    if (addrData) {\n        // const out = new Elements();\n\n        // let _replyText = 'A entrega ser para esse endereo?\\n';\n        // _replyText = _replyText + addrData.formattedAddress;\n\n        // out.add({ text: _replyText });\n\n        // const replies = new QuickReplies();\n        // replies.add({ text: 'Sim', data: addrData, event: 'CORRECT_SAVED_ADDRESS' });\n        // replies.add({ text: 'No', data: addrData, event: 'WRONG_SAVED_ADDRESS' });\n        // out.setQuickReplies(replies);\n\n        // await updateOrder({ pageId, userId, user, waitingFor: 'confirm_address' });\n\n        // return out;\n        return confirmAddress(pageId, userId, addrData, user);\n    } else {\n        return await askForLocation(pageId, userId, user);\n    }\n}\n\nexport const askToTypeAddress = async (pageID, userID) => {\n    await updateOrder({ pageId: pageID, userId: userID, waitingForAddress: true, waitingFor: 'typed_address' });\n\n    const out = new Elements();\n    out.add({ text: 'No foi possvel localizar um endereo vlido. Digite o seu endereo completo por favor.' });\n    return out;\n}\n\nexport const confirmAddress = async (pageId, userId, addrData, user) => {\n\n    if (user)\n        await updateOrder({ pageId, userId, user, waitingForAddress: false, waitingFor: 'confirm_address' });\n    else\n        await updateOrder({ pageId, userId, waitingForAddress: false, waitingFor: 'confirm_address' });\n\n    const out = new Elements();\n\n    let _replyText = 'A entrega ser para esse endereo?\\n';\n    _replyText = _replyText + addrData.formattedAddress;\n    out.add({ text: _replyText });\n\n    const replies = new QuickReplies();\n    replies.add({ text: 'Sim', data: addrData, event: 'CORRECT_SAVED_ADDRESS' });\n    replies.add({ text: 'No', data: addrData, event: 'WRONG_SAVED_ADDRESS' });\n    out.setQuickReplies(replies);\n    return out;\n}\n\nexport const showAddress = async (pageId, userId, addrData) => {\n    if (addrData && addrData.address_components) {\n        const formattedAddrData = await formatAddrData(addrData);\n        await updateOrder({ pageId, userId, addrData: formattedAddrData });\n    }\n    else {\n        await updateOrder({ pageId, userId, addrData });\n    }\n\n    const out = new Elements();\n    out.add({ text: 'Ok, entregaremos nesse endereo.' });\n    return out;\n}\n\nexport const showOrderOrAskForPhone = async (pageId, userId) => {\n    const po = await getOrderPending({ pageId, userId, isComplete: false });\n\n    if (po.order && po.order.waitingFor === 'confirmation')\n        return await showOrderOrNextItem(pageId, userId);\n    else\n        return await askForPhone(pageId, userId);\n}\n\nexport const askForPhone = async (pageId, userId) => {\n\n    await updateOrder({ pageId, userId, waitingFor: 'phone' });\n\n    const out = new Elements();\n    out.add({ text: 'Pode nos enviar o seu telefone para confirmar o seu pedido? Se no aparecer o seu telefone (ou estiver errado), use a opo digitar.' });\n\n    const replies = new QuickReplies();\n    replies.add({ text: 'Telefone', isPhoneNumber: true, data: 'phone_number', event: 'PHONE_NUMBER' });\n    replies.add({ text: 'Digitar o telefone', data: 'change_phone', event: 'PHONE_CONFIRMED' });\n    out.setQuickReplies(replies);\n    return out;\n}\n\nexport const askToTypePhone = async (pageId, userId) => {\n\n    await updateOrder({ pageId, userId, waitingFor: 'phone' });\n\n    const out = new Elements();\n    out.add({ text: 'Por favor, digite o nmero do telefone vlido para que possamos confirmar o pedido. Pode digitar o :' });\n    return out;\n}\n\nexport const confirmTypedPhone = async (pageId, userId, phone) => {\n    const out = new Elements();\n\n    await updateOrder({ pageId, userId, waitingFor: 'phone' });\n\n    let _txt = 'O telefone ' + phone + ' est coreto?';\n    out.add({ text: _txt });\n\n    const replies = new QuickReplies();\n    replies.add({ text: \"Sim\", data: phone, event: 'PHONE_CONFIRMED' });\n    replies.add({ text: \"No, usar outro\", data: \"change_phone\", event: 'PHONE_CONFIRMED' });\n    out.setQuickReplies(replies);\n\n    return out;\n}\n\n\nexport const showPhone = async (pageId, userId, phone) => {\n    await updateOrder({ pageId, userId, phone, waitingFor: 'nothing' });\n\n    const out = new Elements();\n    out.add({ text: 'Usaremos o nmero ' + phone + ' para confirmar o pedido. Agora vou pegar as informaes do pedido.' });\n    return out;\n}\n\n\n// export const askForEmail = async () => {\n//     const out = new Elements();\n//     out.add({ text: 'Pode tambm nos enviar o seu e-mail?' });\n\n//     const replies = new QuickReplies();\n//     replies.add({ text: 'E-mail', isPhoneNumber: true, data: 'phone_number', event: 'PHONE_NUMBER' });\n//     out.setQuickReplies(replies);\n//     return out;\n// }\n\nexport const askForQuantity = async (pageId, userId) => {\n    const out = new Elements();\n    out.add({ text: 'Quantas pizzas voc quer?' });\n\n    const replies = new QuickReplies();\n    replies.add({ text: '1', data: 'qty_1', event: 'ORDER_QTY' });\n    replies.add({ text: '2', data: 'qty_2', event: 'ORDER_QTY' });\n    replies.add({ text: '3', data: 'qty_3', event: 'ORDER_QTY' });\n    replies.add({ text: '+ de 3', data: 'qty_more', event: 'ORDER_QTY' });\n    out.setQuickReplies(replies);\n\n    await updateOrder({ pageId, userId, waitingFor: 'quantity' });\n\n    return out;\n}\n\nexport const askForQuantityMore = async (pageId, userId) => {\n    const out = new Elements();\n    out.add({ text: 'Por favor informe a quantidade de pizzas:' });\n\n    const replies = new QuickReplies();\n    replies.add({ text: '- de 4', data: 'qty_less', event: 'ORDER_QTY' });\n    replies.add({ text: '4', data: 'qty_4', event: 'ORDER_QTY' });\n    replies.add({ text: '5', data: 'qty_5', event: 'ORDER_QTY' });\n    replies.add({ text: '6', data: 'qty_6', event: 'ORDER_QTY' });\n    // replies.add({ text: '+ de 6', data: 'qty_more_more', event: 'ORDER_QTY' });\n    out.setQuickReplies(replies);\n\n    await updateOrder({ pageId, userId, waitingFor: 'quantity' });\n\n    return out;\n}\n\nexport const showQuantity = async (pageId, userId, data) => {\n    // data is 'qty_1', 'qty_2', 'qty_3'...\n    const qty = new String(data).substr(data.length - 1, 1);\n\n    await updateOrder({ pageId, userId, qty, waitingFor: 'size', currentItem: 1 });\n\n    const out = new Elements();\n    if (qty == 1) {\n        out.add({ text: ' ' + ' 1 pizza.' });\n    } else {\n        out.add({ text: ' ' + qty + ' pizzas.' });\n    }\n    return out;\n}\n\nexport const askForSize = async (pageId, userId) => {\n\n    const out = new Elements();\n    const po = await getOrderPending({ pageId, userId, isComplete: false });\n\n    if (po.order) {\n        let _text = '';\n        if (po.order.qty_total === 1) {\n            _text = 'Qual o tamanho da pizza?';\n        } else {\n            _text = 'Agora vou pegar os detalhes da ' + po.order.currentItem + 'a. pizza.\\n';\n            _text = _text + 'Qual o tamanho dela?';\n        }\n        out.add({ text: _text });\n\n        const replies = new QuickReplies();\n        const sizesWithPricing = await getPricingSizing(pageId); // only sizes with pricing\n        const sizes = await getSizes(pageId, sizesWithPricing);\n        for (let i = 0; i < sizes.length; i++) {\n            const _data = { id: sizes[i].id, size: sizes[i].size, split: sizes[i].split };\n            replies.add({ text: sizes[i].size, data: _data, event: 'ORDER_SIZE' });\n        }\n        out.setQuickReplies(replies);\n\n        if (po.order.qty_total === 1)\n            await updateOrder({ pageId, userId, waitingFor: 'size' });\n        else\n            await updateOrder({ pageId, userId, waitingFor: 'size', qty: po.order.qty_total, eraseSplit: true });\n    }\n    else {\n        out.add({ text: MSG_GENERAL_ERROR });\n    }\n\n    return out;\n}\n\nexport const showSize = async (pageId, userId, data) => {\n    if (data && data.split && data.split > 1)\n        await updateOrder({ pageId, userId, sizeId: data.id, waitingFor: 'split' });\n    else\n        await updateOrder({ pageId, userId, sizeId: data.id, waitingFor: 'flavor' });\n\n    const out = new Elements();\n    out.add({ text: ' ' + ' Tamanho: ' + data.size });\n    return out;\n}\n\nexport const askForSplitFlavorOrConfirm = async (pageId, userId, multiple) => {\n    const pendingOrder = await getOrderPending({ pageId: pageId, userId: userId, isComplete: true });\n    if (pendingOrder.order) {\n        const currentSize = await getSize(pageId, pendingOrder.order.currentItemSize);\n        // if split is gt than 1, ask user if he wants to split in more than one flavor.\n        if (currentSize.split && currentSize.split > 1) {\n            let _txt = 'A pizza ' + currentSize.size + ' pode ser dividida em ' + currentSize.split + ' sabores.\\n';\n            _txt = _txt + 'Escolha quantos sabores voc quer:';\n\n            const out = new Elements();\n            out.add({ text: _txt });\n\n            const replies = new QuickReplies();\n            for (let i = 1; i <= currentSize.split; i++) {\n                let _replyText = i === 1 ? i + ' Sabor' : i + ' Sabores';\n                replies.add({ text: _replyText, data: i, event: 'ORDER_SPLIT' });\n            }\n            out.setQuickReplies(replies);\n\n            return out;\n        } else {\n            return await askForFlavorOrConfirm(pageId, userId, multiple);\n        }\n    }\n}\n\n/**\n * After user answer if he wants to split the pizza, show the chosen option.\n * @param {*} pageId \n * @param {*} userId \n * @param {*} data \n */\nexport const showSplit = async (pageId, userId, data) => {\n    await updateOrder({ pageId, userId, sizeId: data.id, waitingFor: 'flavor', originalSplit: data });\n\n    let _txtFlavor = data === 1 ? 'Sabor' : 'Sabores';\n\n    const out = new Elements();\n    out.add({ text: ' ' + data + ' ' + _txtFlavor });\n    return out;\n}\n\nexport const inputCardapioReplyMsg = (flavorArray) => {\n    let replyMsg = '';\n    if (flavorArray) {\n        for (let i = 0; i < flavorArray.length; i++) {\n            const flavor = flavorArray[i];\n\n            replyMsg = replyMsg + ': ' + flavor.flavor + '\\n';\n            replyMsg = replyMsg + ': ' + flavor.toppingsNames.join(\", \");\n            replyMsg = replyMsg + '\\n\\n';\n        }\n    }\n    return replyMsg;\n}\n\n\n/**\n * Returns array of flavors. If sizeID was passed, only returns flavors with price.\n * @param {*} pageID \n * @param {*} sizeID \n */\nexport const getFlavorsAndToppings = async (pageID, sizeID) => {\n    try {\n        const flavorArray = await getFlavors(pageID);\n        const flavorsWithPrice = new Array();\n        for (let flavor of flavorArray) {\n            if (sizeID) {\n                const pricing = await getOnePricing(pageID, flavor.kind, sizeID);\n                if (pricing) {\n                    flavor.price = pricing.price;\n                }\n            }\n            if (sizeID) {\n                if (flavor.price) {\n                    flavor.toppingsNames = await getToppingsNames(flavor.toppings, pageID);\n                    flavorsWithPrice.push(flavor);\n                }\n            } else {\n                flavor.toppingsNames = await getToppingsNames(flavor.toppings, pageID);\n                flavorsWithPrice.push(flavor);\n            }\n        }\n        return flavorsWithPrice;\n    } catch (flavorsAndToppingsErr) {\n        console.error({ flavorsAndToppingsErr });\n    }\n}\n\n\nexport const askForFlavorOrConfirm = async (pageId, userId, multiple, split) => {\n    const pendingOrder = await getOrderPending({ pageId: pageId, userId: userId, isComplete: true });\n\n    if (pendingOrder.order) {\n        if (split && split > 1) {\n            return await askForFlavor(pageId, userId, multiple, split, pendingOrder);\n        } else {\n            const currentSize = await getSize(pageId, pendingOrder.order.currentItemSize);\n\n            if (pendingOrder.items && pendingOrder.items.length) {\n                for (let i = 0; i < pendingOrder.items.length; i++) {\n                    if (pendingOrder.items[i].status === 0 && pendingOrder.items[i].flavorId > 0) {\n                        await updateStatusSpecificItem(pendingOrder.items[i]._id, 1);\n                        return await showOrderOrNextItem(pageId, userId);\n                    }\n                }\n                return await askForFlavor(pageId, userId, multiple);\n            }\n        }\n    }\n}\n\n/**\n * \n * @param {*} pageId \n * @param {*} userId \n * @param {*} multiple: if are the first 4 flavors, multiple=1, if are the next, multiple=2 and so on. \n */\nexport const askForFlavor = async (pageId, userId, multiple, split, pendingOrder) => {\n    const out = new Elements();\n\n    out.setListStyle('compact'); // or 'large'\n\n    let po = null;\n    if (pendingOrder)\n        po = pendingOrder;\n    else po = await getOrderPending({ pageId: pageId, userId: userId, isComplete: false });\n\n    const flavorsArray = await getFlavorsAndToppings(pageId, po.order.currentItemSize);\n\n    let _rangeIni = (multiple - 1) * 4;\n    let _rangeEnd = multiple * 4;\n\n    for (let i = _rangeIni; i < _rangeEnd; i++) {\n        if (flavorsArray[i]) {\n            const _fl = flavorsArray[i];\n            const _data = { id: _fl.id, flavor: _fl.flavor }\n            const buttons = new Buttons();\n            buttons.add({ text: 'Quero', data: _data, event: 'ORDER_FLAVOR' });\n\n            let _subtext = _fl.toppingsNames.join();\n            if (_fl.price) {\n                _subtext = _subtext.concat('\\n R$', _fl.price);\n            }\n            out.add({ text: _fl.flavor, subtext: _subtext, buttons });\n        }\n    }\n\n\n    if (flavorsArray.length > _rangeEnd) {\n        multiple++;\n        const buttonsOpt = new Buttons();\n        buttonsOpt.add({ text: '+ Opes', data: { option: \"flavors_more\", multiple: multiple }, event: 'ORDER_FLAVOR' });\n        out.add({ buttons: buttonsOpt, isOnlyButtons: true });\n    }\n\n\n    await updateOrder({ pageId, userId, waitingFor: 'flavor', split: split });\n\n    return out;\n}\n\nexport const showFlavor = async (pageId, userId, data) => {\n    await updateOrder({ pageId, userId, flavorId: data.id, completeItem: true, waitingFor: 'nothing', calcTotal: true });\n\n    const out = new Elements();\n    out.add({ text: ' ' + ' Sabor: ' + data.flavor });\n    return out;\n}\n\nexport const showOrderOrNextItem = async (pageId, userId) => {\n    const po = await getOrderPending({ pageId, userId, isComplete: true });\n\n    if (po.order.currentItemSplit > 1) {\n        const split = po.order.currentItemSplit - 1;\n        return await askForFlavor(pageId, userId, 1, split, po);\n    }\n    else if (po.order.qty_total > 1 && po.order.item_complete < po.order.qty_total) {\n        const nextItem = po.order.currentItem + 1;\n        await updateOrder({ pageId, userId, waitingFor: 'size', currentItem: nextItem });\n        return await askForSize(pageId, userId);\n    }\n    else {\n        await updateOrder({ pageId, userId, waitingFor: 'want_beverage' });\n\n        const out = new Elements();\n        let total_price = 0;\n        let _txt = 'Seguem os detalhes do seu pedido:\\n';\n        _txt = _txt + ':' + po.order.id + '\\n';\n        for (let i = 0; i < po.items.length; i++) {\n            const _item = po.items[i];\n            if (_item.flavorId && _item.sizeId) {\n                let _txtQty = _item.split > 1 ? _item.qty + '/' + _item.split : _item.qty;\n                _txt = _txt + `${_txtQty} pizza ${_item.size} de ${_item.flavor}\\n`;\n            } else if (_item.beverageId && _item.beverage) {\n                _txt = _txt + `1 ${_item.beverage}\\n`;\n            }\n            total_price += _item.price;\n        }\n        _txt = _txt + '  : ' + po.order.address + '\\n';\n        _txt = _txt + ': ' + po.order.phone + '\\n';\n        _txt = _txt + ': R$ ' + total_price + '\\n';\n        _txt = _txt + 'O pedido est correto?';\n\n        out.add({ text: _txt });\n\n        const replies = new QuickReplies();\n        replies.add({ text: \"Sim\", data: \"confirmation_yes\", event: 'ORDER_PIZZA_CONFIRMATION' });\n        replies.add({ text: \"No\", data: \"confirmation_no\", event: 'ORDER_PIZZA_CONFIRMATION' });\n        out.setQuickReplies(replies);\n\n        return out;\n    }\n}\n\nexport const askForPaymentType = async (pageId, userId) => {\n    const out = new Elements();\n    out.add({ text: 'Qual a forma de pagamento?' });\n\n    const replies = new QuickReplies();\n    replies.add({ text: 'Dinheiro', data: 'payment_money', event: 'ORDER_PAYMENT_TYPE' });\n    replies.add({ text: 'Carto', data: 'payment_card', event: 'ORDER_PAYMENT_TYPE' });\n    out.setQuickReplies(replies);\n\n    await updateOrder({ pageId, userId, waitingFor: 'payment_type' });\n\n    return out;\n}\n\nexport const showPaymentType = async (pageId, userId, data) => {\n    await updateOrder({ pageId, userId, paymentType: data });\n\n    let _txtPaymentType = data === 'payment_money' ? 'Dinheiro' : 'Carto';\n\n    const out = new Elements();\n    out.add({ text: ' ' + ' Forma de pagamento: ' + _txtPaymentType });\n    return out;\n}\n\nexport const askForPaymentChange = async (pageId, userId) => {\n    const out = new Elements();\n    out.add({ text: 'Precisa de troco?' });\n\n    const replies = new QuickReplies();\n    replies.add({ text: 'Sim', data: 'payment_change_yes', event: 'ORDER_PAYMENT_CHANGE' });\n    replies.add({ text: 'No', data: 'payment_change_no', event: 'ORDER_PAYMENT_CHANGE' });\n    out.setQuickReplies(replies);\n\n    await updateOrder({ pageId, userId, waitingFor: 'payment_change' });\n\n    return out;\n}\n\nexport const showPaymentChange = async (pageId, userId, data) => {\n    await updateOrder({ pageId, userId, paymentChange: data });\n\n    let _txtPaymentChange = data === 'payment_change_yes' ? 'Levaremos trocado' : 'No precisa de troco';\n\n    const out = new Elements();\n    out.add({ text: ' ' + _txtPaymentChange });\n    return out;\n}\n\n\nexport const showFullOrder = async (pageId, userId) => {\n    const po = await getOrderPending({ pageId, userId, isComplete: true });\n\n    const out = new Elements();\n    let total_price = 0;\n    let _txt = 'Seguem os detalhes do seu pedido:\\n';\n\n\n\n    _txt = _txt + ': ' + po.order.id + '\\n';\n    for (let i = 0; i < po.items.length; i++) {\n        const _item = po.items[i];\n        if (_item.flavorId && _item.sizeId) {\n            let _txtQty = _item.split > 1 ? _item.qty + '/' + _item.split : _item.qty;\n            _txt = _txt + `${_txtQty} pizza ${_item.size} de ${_item.flavor}\\n`;\n        } else if (_item.beverageId && _item.beverage) {\n            _txt = _txt + `1 ${_item.beverage}\\n`;\n        }\n        total_price += _item.price;\n    }\n    _txt = _txt + '  : ' + po.order.address + '\\n';\n    _txt = _txt + ': ' + po.order.phone + '\\n';\n    _txt = _txt + ': R$ ' + total_price + '\\n';\n\n    let _txtPaymentType = po.payment_type === 'payment_card' ? 'Carto' : 'Dinheiro';\n    _txt = _txt + '  : ' + _txtPaymentType + '\\n';\n\n    if (po.payment_change === 'payment_change_yes') {\n        _txt = _txt + ' ? Sim \\n';\n    }\n\n    _txt = _txt + 'Posso confirmar o pedido?';\n\n    out.add({ text: _txt });\n\n    const replies = new QuickReplies();\n    replies.add({ text: \"Sim\", data: \"confirmation_yes\", event: 'ORDER_CONFIRMATION' });\n    replies.add({ text: \"No\", data: \"confirmation_no\", event: 'ORDER_CONFIRMATION' });\n    out.setQuickReplies(replies);\n\n    return out;\n}\n\n\nexport const confirmOrder = async (pageId, userId) => {\n    await updateOrder({ pageId, userId, confirmOrder: true, calcTotal: true });\n\n    const out = new Elements();\n    out.add({ text: \"Pedido Confirmado!\" });\n    return out;\n}\n\nexport const askForChangeOrder = async (pageId, userId) => {\n    const out = new Elements();\n\n    await updateOrder({ pageId, userId, waitingFor: 'confirmation' });\n\n    let _txt = 'O que voc gostaria de fazer com o seu pedido?';\n    out.add({ text: _txt });\n\n    const replies = new QuickReplies();\n    replies.add({ text: \"Mudar pedido\", data: \"changeOrder\", event: 'ORDER_WANT_CHANGE' });\n    replies.add({ text: \"Mudar endereo\", data: \"change_address\", event: 'ORDER_CHANGE' });\n    replies.add({ text: \"Confirmar.\", data: \"confirmation_yes\", event: 'ORDER_CONFIRMATION' });\n    out.setQuickReplies(replies);\n\n    return out;\n}\n\nexport const askForOptionsToChange = async (pageId, userId, item) => {\n    try {\n        if (item && item.beverageId) {\n            return await askForBeverages(pageId, userId, 1);\n        } else {\n            const out = new Elements();\n\n            let _txt = 'Ok, qual das informaes que voc gostaria de alterar?';\n            out.add({ text: _txt });\n\n            const replies = new QuickReplies();\n            // replies.add({ text: \"Quantidade\", data: \"change_quantity\", event: 'ORDER_CHANGE' });\n            replies.add({ text: \"Tamanho\", data: \"change_size\", event: 'ORDER_CHANGE' });\n            replies.add({ text: \"Sabor\", data: \"change_flavor\", event: 'ORDER_CHANGE' });\n            out.setQuickReplies(replies);\n            return out;\n        }\n    } catch (askForOptionsToChangeErr) {\n        console.error({ askForOptionsToChangeErr });\n        throw askForOptionsToChangeErr;\n    }\n}\n\nexport const askForSpecificItem = async (pageId, userId) => {\n    const pendingOrder = await getOrderPending({ pageId, userId, isComplete: true });\n    if (pendingOrder.items && pendingOrder.items.length > 1) {\n        const out = new Elements();\n        out.add({ text: 'Primeiro, escolha qual os itens deseja mudar:' });\n\n        const replies = new QuickReplies();\n        let i = 1;\n        pendingOrder.items.forEach(item => {\n            let _txt = item.flavor ? item.flavor : item.beverage;\n            replies.add({ text: i + \"a. \" + _txt, data: item._id, event: 'ORDER_CHANGE_SELECT_ITEM' });\n            i++;\n        });\n        out.setQuickReplies(replies);\n        return out;\n    } else {\n        await updateOrder({ pageId, userId, completeItem: false });\n        return await askForOptionsToChange(pageId, userId);\n    }\n}\n\n/**\n * \n * @param {*} pageId \n * @param {*} userId \n */\nexport const askForWantBeverage = async (pageId, userId) => {\n    const pendingOrder = await getOrderPending({ pageId, userId, isComplete: false });\n\n    const noBeverage = pendingOrder.order.no_beverage;\n\n    if (typeof noBeverage === 'undefined') {\n\n        const out = new Elements();\n        let _txt = 'Gostaria de algo para beber?';\n        out.add({ text: _txt });\n\n        const replies = new QuickReplies();\n        // replies.add({ text: \"Quantidade\", data: \"change_quantity\", event: 'ORDER_CHANGE' });\n        replies.add({ text: \"Sim\", data: \"beverage_yes\", event: 'ORDER_CONFIRM_BEVERAGE' });\n        replies.add({ text: \"No\", data: \"beverage_no\", event: 'ORDER_CONFIRM_BEVERAGE' });\n        out.setQuickReplies(replies);\n        return out;\n    } else {\n        return showFullOrder(pageId, userId);\n    }\n}\n/**\n * \n * @param {*} pageId \n * @param {*} userId \n * @param {*} multiple \n */\nexport const askForBeverages = async (pageId, userId, multiple) => {\n    const out = new Elements();\n    out.setListStyle('compact'); // or 'large'\n\n    // const po = await getOrderPending({ pageId: pageId, userId: userId, isComplete: false });\n\n    const beveragesArr = await getBeverages(pageId);\n    let _rangeIni = (multiple - 1) * 4;\n    let _rangeEnd = multiple * 4;\n\n    for (let i = _rangeIni; i < _rangeEnd; i++) {\n        if (beveragesArr[i]) {\n            const _bev = beveragesArr[i];\n            const _data = { id: _bev.id, beverage: _bev.name, price: _bev.price }\n            const buttons = new Buttons();\n            buttons.add({ text: 'Quero', data: _data, event: 'ORDER_BEVERAGE' });\n\n            let _subtext = _bev.kind;\n            if (_bev.price) {\n                _subtext = _subtext.concat('\\n R$', _bev.price);\n            }\n            out.add({ text: _bev.name, subtext: _subtext, buttons });\n        }\n    }\n    if ((beveragesArr.length + 1) > _rangeEnd) {\n        multiple++;\n        const buttonsOpt = new Buttons();\n        buttonsOpt.add({ text: '+ Opes (clique aqui para ver + opes..)', data: { option: \"beverages_more\", multiple: multiple }, event: 'ORDER_BEVERAGE' });\n        out.add({ buttons: buttonsOpt, isOnlyButtons: true });\n    } else {\n        // const lastButton = new Buttons();\n        // lastButton.add({ text: 'No tem, cancelar.', data: { option: \"beverages_cancel\" }, event: 'ORDER_BEVERAGE' });\n        // out.add({ buttons: lastButton, isOnlyButtons: true });\n\n        const _data = { option: 'beverages_cancel' }\n        const buttons = new Buttons();\n        buttons.add({ text: 'Sem bebida', data: _data, event: 'ORDER_BEVERAGE' });\n        let _subtext = 'Se no encontrou, clique em \"Sem bebida\"';\n        out.add({ text: 'No encontrei', subtext: _subtext, buttons });\n    }\n\n    await updateOrder({ pageId, userId, waitingFor: 'beverage', noBeverage: false });\n    return out;\n}\n\n/**\n * Show that user did not want beverage and update order with this info.\n * @param {*} pageId \n * @param {*} userId \n * @param {*} data \n */\nexport const showNoBeverage = async (pageId, userId, data) => {\n    await updateOrder({ pageId, userId, noBeverage: true, waitingFor: 'confirm' });\n\n    const out = new Elements();\n    out.add({ text: ' ' + ' Sem bebida para o seu pedido. ' });\n    return out;\n}\n\n/**\n * Show the chosen beverage.\n * @param {*} pageId \n * @param {*} userId \n * @param {*} data \n */\nexport const showBeverage = async (pageId, userId, data) => {\n    await updateOrder({ pageId, userId, beverageId: data.id, beveragePrice: data.price, completeItem: true, noBeverage: false, waitingFor: 'confirmation', calcTotal: true });\n\n    const out = new Elements();\n    out.add({ text: ' ' + '1 Bebida: ' + data.beverage });\n    return out;\n}\n\nexport const updateItemAskOptions = async (pageId, userId, objectId) => {\n    const item = await updateStatusSpecificItem(objectId, 0);\n    return await askForOptionsToChange(pageId, userId, item);\n}\n\nexport const sendShippingNotification = async (pageId, userId, orderId) => {\n    const { accessToken } = await getOnePageToken(pageId);\n\n    const _txt = 'O seu pedido nmero ' + orderId + ' acabou de sair para entrega. Bom apetite!';\n\n    const out = new Elements();\n    out.add({ text: _txt });\n    await Bot.send_message_tag(accessToken, userId, out);\n}\n\nexport const sendRejectionNotification = async (pageId, userId, orderId, rejectionExplanation) => {\n    const { accessToken } = await getOnePageToken(pageId);\n\n    const _txt = 'Infelizmente no poderemos atender o seu pedido nmero ' + orderId + '. Segue o motivo: ' + rejectionExplanation;\n\n    const out = new Elements();\n    out.add({ text: _txt });\n    await Bot.send_message_tag(accessToken, userId, out);\n}\n\n\n\n"],"file":"bkpBotController.js"}