{"version":3,"sources":["../../../src/api/bot/botController.js"],"names":["log_file","fs","createWriteStream","__dirname","flags","log_stdout","process","stdout","console","log","d","write","util","format","MSG_GENERAL_ERROR","sendErrorMsg","_errorMsg","out","Elements","_showErrorMsg","add","text","basicReply","replyText","askForContinue","pageId","userId","_txt","replies","QuickReplies","data","event","setQuickReplies","checkLastAction","pendingOrder","order","waitingFor","addrData","confirmAddress","askForLocation","location","lat","location_lat","long","location_long","url","location_url","confirmLocationAddress","askForSize","askForQuantity","askForSplitFlavorOrConfirm","askForFlavor","askForWantBeverage","askForBeverages","showFullOrder","showOrderOrNextItem","sendMainMenu","optionsStopOrder","passThreadControl","result","sendWelcomeMessage","pageID","sender","fetch","page","replyMsg","String","firstResponseText","replace","first_name","buttons","Buttons","sendHorario","todayIsOpen","todayOpenAt","todayCloseAt","sendCardapio","askForWantOrder","isLocation","addresses","length","setListStyle","foundAnyCompleteAddress","i","element","address_components","_data","formatted_address","addressNumber","subtext","buttonsOpt","isOnlyButtons","askToTypeAddress","confirmAddressOrAskLocation","user","userID","waitingForAddress","_replyText","formattedAddress","showAddress","formattedAddrData","showOrderOrAskForPhone","isComplete","po","askForPhone","isPhoneNumber","askToTypePhone","confirmTypedPhone","phone","showPhone","askForQuantityMore","showQuantity","qty","substr","currentItem","_text","qty_total","sizesWithPricing","sizes","id","size","split","eraseSplit","showSize","sizeId","multiple","currentItemSize","currentSize","askForFlavorOrConfirm","showSplit","originalSplit","_txtFlavor","items","status","flavorId","_id","flavorsArray","_rangeIni","_rangeEnd","_fl","flavor","_subtext","toppingsNames","join","price","concat","option","showFlavor","completeItem","calcTotal","currentItemSplit","item_complete","nextItem","total_price","_item","_txtQty","beverageId","beverage","address","confirmOrder","askForChangeOrder","askForOptionsToChange","item","error","askForOptionsToChangeErr","askForSpecificItem","forEach","noBeverage","no_beverage","beveragesArr","_bev","name","kind","showNoBeverage","showBeverage","beveragePrice","updateItemAskOptions","objectId","sendShippingNotification","orderId","accessToken","Bot","send_message_tag"],"mappings":"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","sourcesContent":["import util from 'util';\nimport fs from 'fs';\nimport { Bot, Elements, Buttons, QuickReplies } from 'facebook-messenger-bot';\nimport { getOnePageToken, getOnePageData, sendPassThreadControl } from '../controllers/pagesController';\nimport { getPricingSizing } from '../controllers/pricingsController';\nimport getCardapio from './show_cardapio';\nimport {\n    getFlavorsAndToppings,\n} from \"./actionsController\";\nimport { getSizes, getSize } from '../controllers/sizesController';\nimport { getBeverages } from '../controllers/beveragesController';\nimport { getTodayOpeningTime } from '../controllers/storesController';\nimport { updateOrder, getOrderPending } from '../controllers/ordersController';\nimport { getAddressLocation, getCustomerAddress, formatAddrData } from '../controllers/customersController';\nimport { updateStatusSpecificItem } from '../controllers/itemsController';\n\n// TODO: create a debugger with json format\nvar log_file = fs.createWriteStream(__dirname + '/debug.log', { flags: 'w' });\nvar log_stdout = process.stdout;\n\nconsole.log = function (d) { //\n    log_file.write(util.format(d) + '\\n');\n    log_stdout.write(util.format(d) + '\\n');\n};\n\nconst MSG_GENERAL_ERROR = 'Ops, estamos com um probleminha t√©cnico: ';\n\n// // create a custom timestamp format for log statements\n// const SimpleNodeLogger = require('simple-node-logger'),\n//     opts = {\n//         logFilePath: 'logs/bot.log',\n//         timestampFormat: 'YYYY-MM-DD HH:mm:ss.SSS'\n//     },\n//     log = SimpleNodeLogger.createSimpleLogger(opts);\n\nexport const sendErrorMsg = async (_errorMsg) => {\n    const out = new Elements();\n    let _showErrorMsg = _errorMsg ? _errorMsg : 'ERRO DESCONHECIDO';\n    out.add({ text: MSG_GENERAL_ERROR + _showErrorMsg });\n    return out;\n}\n\n// export const updateOrderFlow = async (pageID, userID) => {\n\n// }\n\nexport const basicReply = async (replyText) => {\n    const out = new Elements();\n    if (!replyText) {\n        replyText = 'Hi, how are you doing?';\n    }\n    out.add({ text: replyText });\n    return out;\n}\n\n/**\n * Send Yes or No to the user asking if he wants to place an order right now.\n * @param {*} pageId \n * @param {*} userId \n */\nexport const askForContinue = async (pageId, userId) => {\n    const out = new Elements();\n    let _txt = 'N√£o entendi o que voc√™ quis dizer. üòû. Vamos continuar com o pedido?';\n    out.add({ text: _txt });\n\n    const replies = new QuickReplies();\n    // replies.add({ text: \"Quantidade\", data: \"change_quantity\", event: 'ORDER_CHANGE' });\n    replies.add({ text: \"Sim\", data: \"continueorder_yes\", event: 'ORDER_CONTINUE_ORDER' });\n    replies.add({ text: \"N√£o\", data: \"continueorder_no\", event: 'ORDER_CONTINUE_ORDER' });\n    out.setQuickReplies(replies);\n    return out;\n}\n\nexport const checkLastAction = async (pageId, userId) => {\n\n    const pendingOrder = await getOrderPending({ pageId, userId });\n\n    if (pendingOrder.order) {\n        if (pendingOrder.order.waitingFor === 'confirm_address') {\n            const addrData = await getCustomerAddress(pageId, userId);\n            return await confirmAddress(pageId, userId, addrData);\n        }\n        else if (pendingOrder.order.waitingFor === 'location')\n            return await askForLocation(pageId, userId);\n        else if (pendingOrder.order.waitingFor === 'location_address') {\n            const location = {\n                lat: pendingOrder.order.location_lat,\n                long: pendingOrder.order.location_long,\n                url: pendingOrder.order.location_url,\n            }\n            return await confirmLocationAddress(pageId, userId, location);\n        }\n        else if (pendingOrder.order.waitingFor === 'size')\n            return await askForSize(pageId, userId)\n        else if (pendingOrder.order.waitingFor === 'quantity')\n            return await askForQuantity(pageId, userId);\n        else if (pendingOrder.order.waitingFor === 'split')\n            return askForSplitFlavorOrConfirm(pageId, userId, 1);\n        else if (pendingOrder.order.waitingFor === 'flavor')\n            return await askForFlavor(pageId, userId, 1);\n        else if (pendingOrder.order.waitingFor === 'want_beverage')\n            return await askForWantBeverage(pageId, userId);\n        else if (pendingOrder.order.waitingFor === 'beverage')\n            return await askForBeverages(pageId, userId, 1);\n        else if (pendingOrder.order.waitingFor === 'confirmation')\n            return await showFullOrder(pageId, userId);\n        else if (pendingOrder.order.waitingFor === 'nothing')\n            return await showOrderOrNextItem(pageId, userId);\n        else\n            return await sendMainMenu();\n    } else\n        return await sendMainMenu();\n}\n\nexport const optionsStopOrder = async (pageId, userId) => {\n    const out = new Elements();\n    let _txt = 'Muito bem, aqui est√£o as op√ß√µes:';\n    out.add({ text: _txt });\n\n    const replies = new QuickReplies();\n    // replies.add({ text: \"Quantidade\", data: \"change_quantity\", event: 'ORDER_CHANGE' });\n    replies.add({ text: \"Voltar p/ In√≠cio\", data: \"stoporder_init\", event: 'STOP_ORDER_OPTIONS' });\n    replies.add({ text: \"Falar c/ Humano\", data: \"stoporder_human\", event: 'STOP_ORDER_OPTIONS' });\n    out.setQuickReplies(replies);\n    return out;\n}\n\nexport const passThreadControl = async (pageId, userId) => {\n    const out = new Elements();\n\n    const result = await sendPassThreadControl(pageId, userId);\n    if (result === 200) {\n        let _txt = 'Ok, a partir de agora voc√™ est√° nas m√£os do nosso humano. \\\n    O que voc√™ escrever a partir de agora ser√° respondido por uma pessoa, \\\n    o mais r√°pido poss√≠vel!';\n        out.add({ text: _txt });\n    } else {\n        let _txt = 'Ops, tivemos um probleminha. Tente novamente';\n        out.add({ text: _txt });\n    }\n    return out;\n}\n\n\n/**\n * \n * @param {*} sender \n * @param {*} pageID \n */\nexport const sendWelcomeMessage = async (pageID, sender) => {\n    await sender.fetch('first_name');\n    const page = await getOnePageData(pageID);\n    const replyMsg = new String(page.firstResponseText).replace('$NAME', sender.first_name);\n    const out = new Elements();\n    out.add({ text: replyMsg });\n    return out;\n}\n\nexport const sendMainMenu = async () => {\n    const buttons = new Buttons();\n    buttons.add({ text: 'Card√°pio', data: 'CARDAPIO_PAYLOAD', event: 'MAIN-MENU' });\n    buttons.add({ text: 'Hor√°rios', data: 'HORARIO_PAYLOAD', event: 'MAIN-MENU' });\n    buttons.add({ text: 'Fazer Pedido', data: 'PEDIDO_PAYLOAD', event: 'MAIN-MENU' });\n\n    const out = new Elements();\n    out.add({ text: 'Por favor escolha uma das op√ß√µes', buttons });\n\n    return out;\n}\n\nexport const sendHorario = async (pageID) => {\n    const { todayIsOpen, todayOpenAt, todayCloseAt } = await getTodayOpeningTime(pageID);\n\n    let replyMsg = '';\n    if (todayIsOpen === true) {\n        replyMsg = 'Estamos abertos hoje, a partir das ' + todayOpenAt + ' horas, at√© √†s ' + todayCloseAt + ' horas.';\n    } else {\n        replyMsg = 'Infelizmente hoje n√£o estamos abertos, mas voc√™ pode consultar nosso card√°pio no menu principal.';\n    }\n    const out = new Elements();\n    out.add({ text: replyMsg });\n    return out;\n}\n\nexport const sendCardapio = async (pageID) => {\n    const replyMsg = await getCardapio(pageID);\n    const out = new Elements();\n    out.add({ text: replyMsg });\n\n    return out;\n}\n\n/**\n * Send Yes or No to the user asking if he wants to place an order right now.\n * @param {*} pageId \n * @param {*} userId \n */\nexport const askForWantOrder = async (pageId, userId) => {\n    const out = new Elements();\n    let _txt = 'Agora que voc√™ viu nosso card√°pio, voc√™ est√° pronto para fazer o pedido?';\n    out.add({ text: _txt });\n\n    const replies = new QuickReplies();\n    // replies.add({ text: \"Quantidade\", data: \"change_quantity\", event: 'ORDER_CHANGE' });\n    replies.add({ text: \"Sim\", data: \"wantorder_yes\", event: 'ORDER_WANT_ORDER' });\n    replies.add({ text: \"N√£o\", data: \"wantorder_no\", event: 'ORDER_WANT_ORDER' });\n    out.setQuickReplies(replies);\n    return out;\n}\n\n\n/**\n * Question No.01\n * If the user doesnt have an address in the database, this will be the first question.\n */\nexport const askForLocation = async (pageId, userId) => {\n    await updateOrder({ pageId, userId, waitingFor: 'location' });\n\n    const out = new Elements();\n    out.add({ text: 'Para come√ßar, preciso saber aonde voc√™ est√°. Clique no bot√£o abaixo que receberei a sua localiza√ß√£o.' });\n\n    const replies = new QuickReplies();\n    replies.add({ text: 'Localiza√ß√£o', isLocation: true, data: 'location_location', event: 'LOCATION' });\n    // replies.add({ text: 'Informar o CEP', data: 'location_cep', event: 'LOCATION' });\n    out.setQuickReplies(replies);\n    return out;\n}\n\nexport const confirmLocationAddress = async (pageId, userId, location) => {\n\n    await updateOrder({ pageId, userId, location, waitingFor: 'location_address' });\n\n    const addresses = await getAddressLocation(location);\n\n    if (addresses && addresses.length && addresses.length > 0) {\n\n        const out = new Elements();\n        out.setListStyle('compact');\n\n        let foundAnyCompleteAddress = false;\n        for (let i = 0; i < 4; i++) {\n            const element = addresses[i];\n            if (element.address_components && element.address_components.length >= 6) {\n                foundAnyCompleteAddress = true;\n                const _data = { formatted_address: element.formatted_address, address_components: element.address_components };\n                const buttons = new Buttons();\n                buttons.add({ text: 'Esse!', data: _data, event: 'LOCATION_ADDRESS' });\n                let addressNumber = i + 1;\n                out.add({ text: 'Endere√ßo ' + addressNumber, subtext: element.formatted_address, buttons });\n            }\n        }\n\n        if (foundAnyCompleteAddress) {\n            const buttonsOpt = new Buttons();\n            buttonsOpt.add({ text: 'N√£o √© meu endere√ßo..', data: \"incorrect_address\", event: 'LOCATION_ADDRESS' });\n            out.add({ buttons: buttonsOpt, isOnlyButtons: true });\n            return out;\n        } else {\n            return await askToTypeAddress(pageId, userId);\n        }\n    }\n    else {\n        return await askToTypeAddress(pageId, userId);\n    }\n}\n\nexport const confirmAddressOrAskLocation = async (pageId, userId, user) => {\n\n    // TODO: check if the location is in the neighborhood.\n    // TODO: check if the location is the same as stored in db.\n    const addrData = await getCustomerAddress(pageId, userId);\n\n    if (addrData) {\n        // const out = new Elements();\n\n        // let _replyText = 'A entrega ser√° para esse endere√ßo?\\n';\n        // _replyText = _replyText + addrData.formattedAddress;\n\n        // out.add({ text: _replyText });\n\n        // const replies = new QuickReplies();\n        // replies.add({ text: 'Sim', data: addrData, event: 'CORRECT_SAVED_ADDRESS' });\n        // replies.add({ text: 'N√£o', data: addrData, event: 'WRONG_SAVED_ADDRESS' });\n        // out.setQuickReplies(replies);\n\n        // await updateOrder({ pageId, userId, user, waitingFor: 'confirm_address' });\n\n        // return out;\n        return confirmAddress(pageId, userId, addrData, user);\n    } else {\n        return await askForLocation(pageId, userId);\n    }\n}\n\nexport const askToTypeAddress = async (pageID, userID) => {\n    await updateOrder({ pageId: pageID, userId: userID, waitingForAddress: true, waitingFor: 'typed_address' });\n\n    const out = new Elements();\n    out.add({ text: 'N√£o foi poss√≠vel localizar um endere√ßo v√°lido. Digite o seu endere√ßo completo por favor.' });\n    return out;\n}\n\n// export const checkTypedText = async (pageId, userId, text) => {\n//     try {\n//         const pendingOrder = await getOrderPending({ pageId, userId });\n\n//         if (pendingOrder && pendingOrder.order) {\n//             if (typeof pendingOrder.order.waitingForAddress === 'boolean' &&\n//                 pendingOrder.order.waitingForAddress === true) {\n\n//                 const addrData = {\n//                     manual_addres: true,\n//                     formattedAddress: text,\n//                 }\n\n\n//                 return await confirmAddress(pageId, userId, addrData);\n//             }\n//             else {\n//                 if (pendingOrder.order.waitingFor === 'phone')\n//                     return await confirmTypedPhone(pageId, userId, text);\n//                 if (pendingOrder.order.waitingFor === 'quantity' && !isNaN(text) && +text <= 6) {\n//                     const data = 'qty_' + text;\n//                     return await showQuantity(pageId, userId, data)\n//                 }\n//                 else // Bot didn't understand what was typed \n//                     return await askForContinue(pageId, userId);\n//             }\n//         }\n//         else {\n//             return await sendMainMenu();\n//         }\n\n//     } catch (confirmTypedTextError) {\n//         console.error({ confirmTypedTextError });\n//         throw confirmTypedTextError;\n//     }\n// }\n\nexport const confirmAddress = async (pageId, userId, addrData, user) => {\n\n    if (user)\n        await updateOrder({ pageId, userId, user, waitingForAddress: false, waitingFor: 'confirm_address' });\n    else\n        await updateOrder({ pageId, userId, waitingForAddress: false, waitingFor: 'confirm_address' });\n\n    const out = new Elements();\n\n    let _replyText = 'A entrega ser√° para esse endere√ßo?\\n';\n    _replyText = _replyText + addrData.formattedAddress;\n    out.add({ text: _replyText });\n\n    const replies = new QuickReplies();\n    replies.add({ text: 'Sim', data: addrData, event: 'CORRECT_SAVED_ADDRESS' });\n    replies.add({ text: 'N√£o', data: addrData, event: 'WRONG_SAVED_ADDRESS' });\n    out.setQuickReplies(replies);\n    return out;\n}\n\nexport const showAddress = async (pageId, userId, addrData) => {\n    if (addrData && addrData.address_components) {\n        const formattedAddrData = await formatAddrData(addrData);\n        await updateOrder({ pageId, userId, addrData: formattedAddrData });\n    }\n    else {\n        await updateOrder({ pageId, userId, addrData });\n    }\n\n    const out = new Elements();\n    out.add({ text: 'Ok, entregaremos nesse endere√ßo.' });\n    return out;\n}\n\nexport const showOrderOrAskForPhone = async (pageId, userId) => {\n    const po = await getOrderPending({ pageId, userId, isComplete: false });\n\n    if (po.order && po.order.waitingFor === 'confirmation')\n        return await showOrderOrNextItem(pageId, userId);\n    else\n        return await askForPhone(pageId, userId);\n}\n\nexport const askForPhone = async (pageId, userId) => {\n\n    await updateOrder({ pageId, userId, waitingFor: 'phone' });\n\n    const out = new Elements();\n    out.add({ text: 'Pode nos enviar o seu telefone para confirmar o seu pedido? Se n√£o aparecer o seu telefone (ou estiver errado), use a op√ß√£o digitar.' });\n\n    const replies = new QuickReplies();\n    replies.add({ text: 'Telefone', isPhoneNumber: true, data: 'phone_number', event: 'PHONE_NUMBER' });\n    replies.add({ text: 'Digitar o telefone', data: 'change_phone', event: 'PHONE_CONFIRMED' });\n    out.setQuickReplies(replies);\n    return out;\n}\n\nexport const askToTypePhone = async (pageId, userId) => {\n\n    await updateOrder({ pageId, userId, waitingFor: 'phone' });\n\n    const out = new Elements();\n    out.add({ text: 'Por favor, digite o n√∫mero do telefone v√°lido para que possamos confirmar o pedido. Pode digitar o üìû:' });\n    return out;\n}\n\nexport const confirmTypedPhone = async (pageId, userId, phone) => {\n    const out = new Elements();\n\n    await updateOrder({ pageId, userId, waitingFor: 'phone' });\n\n    let _txt = 'O telefone ' + phone + ' est√° coreto?';\n    out.add({ text: _txt });\n\n    const replies = new QuickReplies();\n    replies.add({ text: \"Sim\", data: phone, event: 'PHONE_CONFIRMED' });\n    replies.add({ text: \"N√£o, usar outro\", data: \"change_phone\", event: 'PHONE_CONFIRMED' });\n    out.setQuickReplies(replies);\n\n    return out;\n}\n\n\nexport const showPhone = async (pageId, userId, phone) => {\n    await updateOrder({ pageId, userId, phone, waitingFor: 'nothing' });\n\n    const out = new Elements();\n    out.add({ text: 'Usaremos o n√∫mero ' + phone + ' para confirmar o pedido. Agora vou pegar as informa√ß√µes do pedido.' });\n    return out;\n}\n\n\n// export const askForEmail = async () => {\n//     const out = new Elements();\n//     out.add({ text: 'Pode tamb√©m nos enviar o seu e-mail?' });\n\n//     const replies = new QuickReplies();\n//     replies.add({ text: 'E-mail', isPhoneNumber: true, data: 'phone_number', event: 'PHONE_NUMBER' });\n//     out.setQuickReplies(replies);\n//     return out;\n// }\n\nexport const askForQuantity = async (pageId, userId) => {\n    const out = new Elements();\n    out.add({ text: 'Quantas pizzas voc√™ quer?' });\n\n    const replies = new QuickReplies();\n    replies.add({ text: '1', data: 'qty_1', event: 'ORDER_QTY' });\n    replies.add({ text: '2', data: 'qty_2', event: 'ORDER_QTY' });\n    replies.add({ text: '3', data: 'qty_3', event: 'ORDER_QTY' });\n    replies.add({ text: '+ de 3', data: 'qty_more', event: 'ORDER_QTY' });\n    out.setQuickReplies(replies);\n\n    await updateOrder({ pageId, userId, waitingFor: 'quantity' });\n\n    return out;\n}\n\nexport const askForQuantityMore = async (pageId, userId) => {\n    const out = new Elements();\n    out.add({ text: 'Por favor informe a quantidade de pizzas:' });\n\n    const replies = new QuickReplies();\n    replies.add({ text: '- de 4', data: 'qty_less', event: 'ORDER_QTY' });\n    replies.add({ text: '4', data: 'qty_4', event: 'ORDER_QTY' });\n    replies.add({ text: '5', data: 'qty_5', event: 'ORDER_QTY' });\n    replies.add({ text: '6', data: 'qty_6', event: 'ORDER_QTY' });\n    // replies.add({ text: '+ de 6', data: 'qty_more_more', event: 'ORDER_QTY' });\n    out.setQuickReplies(replies);\n\n    await updateOrder({ pageId, userId, waitingFor: 'quantity' });\n\n    return out;\n}\n\nexport const showQuantity = async (pageId, userId, data) => {\n    // data is 'qty_1', 'qty_2', 'qty_3'...\n    const qty = new String(data).substr(data.length - 1, 1);\n\n    await updateOrder({ pageId, userId, qty, waitingFor: 'size', currentItem: 1 });\n\n    const out = new Elements();\n    if (qty == 1) {\n        out.add({ text: '‚úÖ ' + ' 1 pizza.' });\n    } else {\n        out.add({ text: '‚úÖ ' + qty + ' pizzas.' });\n    }\n    return out;\n}\n\nexport const askForSize = async (pageId, userId) => {\n\n    const out = new Elements();\n    const po = await getOrderPending({ pageId, userId, isComplete: false });\n\n    if (po.order) {\n        let _text = '';\n        if (po.order.qty_total === 1) {\n            _text = 'Qual o tamanho da pizza?';\n        } else {\n            _text = 'Agora vou pegar os detalhes da ' + po.order.currentItem + 'a. pizza.\\n';\n            _text = _text + 'Qual o tamanho dela?';\n        }\n        out.add({ text: _text });\n\n        const replies = new QuickReplies();\n        const sizesWithPricing = await getPricingSizing(pageId); // only sizes with pricing\n        const sizes = await getSizes(pageId, sizesWithPricing);\n        for (let i = 0; i < sizes.length; i++) {\n            const _data = { id: sizes[i].id, size: sizes[i].size, split: sizes[i].split };\n            replies.add({ text: sizes[i].size, data: _data, event: 'ORDER_SIZE' });\n        }\n        out.setQuickReplies(replies);\n\n        if (po.order.qty_total === 1)\n            await updateOrder({ pageId, userId, waitingFor: 'size' });\n        else\n            await updateOrder({ pageId, userId, waitingFor: 'size', qty: po.order.qty_total, eraseSplit: true });\n    }\n    else {\n        out.add({ text: MSG_GENERAL_ERROR });\n    }\n\n    return out;\n}\n\nexport const showSize = async (pageId, userId, data) => {\n    if (data && data.split && data.split > 1)\n        await updateOrder({ pageId, userId, sizeId: data.id, waitingFor: 'split' });\n    else\n        await updateOrder({ pageId, userId, sizeId: data.id, waitingFor: 'flavor' });\n\n    const out = new Elements();\n    out.add({ text: '‚úÖ ' + ' Tamanho: ' + data.size });\n    return out;\n}\n\nexport const askForSplitFlavorOrConfirm = async (pageId, userId, multiple) => {\n    const pendingOrder = await getOrderPending({ pageId: pageId, userId: userId, isComplete: true });\n    if (pendingOrder.order) {\n        const currentSize = await getSize(pageId, pendingOrder.order.currentItemSize);\n        // if split is gt than 1, ask user if he wants to split in more than one flavor.\n        if (currentSize.split && currentSize.split > 1) {\n            let _txt = 'A pizza ' + currentSize.size + ' pode ser dividida em ' + currentSize.split + ' sabores.\\n';\n            _txt = _txt + 'Escolha quantos sabores voc√™ quer:';\n\n            const out = new Elements();\n            out.add({ text: _txt });\n\n            const replies = new QuickReplies();\n            for (let i = 1; i <= currentSize.split; i++) {\n                let _replyText = i === 1 ? i + ' Sabor' : i + ' Sabores';\n                replies.add({ text: _replyText, data: i, event: 'ORDER_SPLIT' });\n            }\n            out.setQuickReplies(replies);\n\n            return out;\n        } else {\n            return await askForFlavorOrConfirm(pageId, userId, multiple);\n        }\n    }\n}\n\n/**\n * After user answer if he wants to split the pizza, show the chosen option.\n * @param {*} pageId \n * @param {*} userId \n * @param {*} data \n */\nexport const showSplit = async (pageId, userId, data) => {\n    await updateOrder({ pageId, userId, sizeId: data.id, waitingFor: 'flavor', originalSplit: data });\n\n    let _txtFlavor = data === 1 ? 'Sabor' : 'Sabores';\n\n    const out = new Elements();\n    out.add({ text: '‚úÖ ' + data + ' ' + _txtFlavor });\n    return out;\n}\n\n\nexport const askForFlavorOrConfirm = async (pageId, userId, multiple, split) => {\n    const pendingOrder = await getOrderPending({ pageId: pageId, userId: userId, isComplete: true });\n\n    if (pendingOrder.order) {\n        if (split && split > 1) {\n            return await askForFlavor(pageId, userId, multiple, split, pendingOrder);\n        } else {\n            const currentSize = await getSize(pageId, pendingOrder.order.currentItemSize);\n\n            if (pendingOrder.items && pendingOrder.items.length) {\n                for (let i = 0; i < pendingOrder.items.length; i++) {\n                    if (pendingOrder.items[i].status === 0 && pendingOrder.items[i].flavorId > 0) {\n                        await updateStatusSpecificItem(pendingOrder.items[i]._id, 1);\n                        return await showOrderOrNextItem(pageId, userId);\n                    }\n                }\n                return await askForFlavor(pageId, userId, multiple);\n            }\n        }\n    }\n}\n\n/**\n * \n * @param {*} pageId \n * @param {*} userId \n * @param {*} multiple: if are the first 4 flavors, multiple=1, if are the next, multiple=2 and so on. \n */\nexport const askForFlavor = async (pageId, userId, multiple, split, pendingOrder) => {\n    const out = new Elements();\n\n    out.setListStyle('compact'); // or 'large'\n\n    let po = null;\n    if (pendingOrder)\n        po = pendingOrder;\n    else po = await getOrderPending({ pageId: pageId, userId: userId, isComplete: false });\n\n    const flavorsArray = await getFlavorsAndToppings(pageId, po.order.currentItemSize);\n\n    let _rangeIni = (multiple - 1) * 4;\n    let _rangeEnd = multiple * 4;\n\n    for (let i = _rangeIni; i < _rangeEnd; i++) {\n        if (flavorsArray[i]) {\n            const _fl = flavorsArray[i];\n            const _data = { id: _fl.id, flavor: _fl.flavor }\n            const buttons = new Buttons();\n            buttons.add({ text: 'Quero', data: _data, event: 'ORDER_FLAVOR' });\n\n            let _subtext = _fl.toppingsNames.join();\n            if (_fl.price) {\n                _subtext = _subtext.concat('\\n R$', _fl.price);\n            }\n            out.add({ text: _fl.flavor, subtext: _subtext, buttons });\n        }\n    }\n\n\n    if (flavorsArray.length > _rangeEnd) {\n        multiple++;\n        const buttonsOpt = new Buttons();\n        buttonsOpt.add({ text: '+ Op√ß√µes', data: { option: \"flavors_more\", multiple: multiple }, event: 'ORDER_FLAVOR' });\n        out.add({ buttons: buttonsOpt, isOnlyButtons: true });\n    }\n\n\n    await updateOrder({ pageId, userId, waitingFor: 'flavor', split: split });\n\n    return out;\n}\n\nexport const showFlavor = async (pageId, userId, data) => {\n    await updateOrder({ pageId, userId, flavorId: data.id, completeItem: true, waitingFor: 'nothing', calcTotal: true });\n\n    const out = new Elements();\n    out.add({ text: '‚úÖ ' + ' Sabor: ' + data.flavor });\n    return out;\n}\n\nexport const showOrderOrNextItem = async (pageId, userId) => {\n    const po = await getOrderPending({ pageId, userId, isComplete: true });\n\n    if (po.order.currentItemSplit > 1) {\n        const split = po.order.currentItemSplit - 1;\n        return await askForFlavor(pageId, userId, 1, split, po);\n    }\n    else if (po.order.qty_total > 1 && po.order.item_complete < po.order.qty_total) {\n        const nextItem = po.order.currentItem + 1;\n        await updateOrder({ pageId, userId, waitingFor: 'size', currentItem: nextItem });\n        return await askForSize(pageId, userId);\n    }\n    else {\n        await updateOrder({ pageId, userId, waitingFor: 'want_beverage' });\n\n        const out = new Elements();\n        let total_price = 0;\n        let _txt = 'Seguem os detalhes do seu pedido:\\n';\n        _txt = _txt + '*Pedido:* ' + po.order.id + '\\n';\n        for (let i = 0; i < po.items.length; i++) {\n            const _item = po.items[i];\n            if (_item.flavorId && _item.sizeId) {\n                let _txtQty = _item.split > 1 ? _item.qty + '/' + _item.split : _item.qty;\n                _txt = _txt + `${_txtQty} pizza ${_item.size} de ${_item.flavor}\\n`;\n            } else if (_item.beverageId && _item.beverage) {\n                _txt = _txt + `1 ${_item.beverage}\\n`;\n            }\n            total_price += _item.price;\n        }\n        _txt = _txt + '*Endere√ßo de entrega:* ' + po.order.address + '\\n';\n        _txt = _txt + '*Telefone:* ' + po.order.phone + '\\n';\n        _txt = _txt + '*Total:* R$ ' + total_price + '\\n';\n        _txt = _txt + 'O pedido est√° correto?';\n\n        out.add({ text: _txt });\n\n        const replies = new QuickReplies();\n        replies.add({ text: \"Sim\", data: \"confirmation_yes\", event: 'ORDER_PIZZA_CONFIRMATION' });\n        replies.add({ text: \"N√£o\", data: \"confirmation_no\", event: 'ORDER_PIZZA_CONFIRMATION' });\n        out.setQuickReplies(replies);\n\n        return out;\n    }\n}\n\nexport const showFullOrder = async (pageId, userId) => {\n    const po = await getOrderPending({ pageId, userId, isComplete: true });\n\n    const out = new Elements();\n    let total_price = 0;\n    let _txt = 'Seguem os detalhes do seu pedido:\\n';\n    _txt = _txt + '*Pedido:* ' + po.order.id + '\\n';\n    for (let i = 0; i < po.items.length; i++) {\n        const _item = po.items[i];\n        if (_item.flavorId && _item.sizeId) {\n            let _txtQty = _item.split > 1 ? _item.qty + '/' + _item.split : _item.qty;\n            _txt = _txt + `${_txtQty} pizza ${_item.size} de ${_item.flavor}\\n`;\n        } else if (_item.beverageId && _item.beverage) {\n            _txt = _txt + `1 ${_item.beverage}\\n`;\n        }\n        total_price += _item.price;\n    }\n    _txt = _txt + '*Endere√ßo de entrega:* ' + po.order.address + '\\n';\n    _txt = _txt + '*Telefone:* ' + po.order.phone + '\\n';\n    _txt = _txt + '*Total:* R$ ' + total_price + '\\n';\n    _txt = _txt + 'Posso confirmar o pedido?';\n\n    out.add({ text: _txt });\n\n    const replies = new QuickReplies();\n    replies.add({ text: \"Sim\", data: \"confirmation_yes\", event: 'ORDER_CONFIRMATION' });\n    replies.add({ text: \"N√£o\", data: \"confirmation_no\", event: 'ORDER_CONFIRMATION' });\n    out.setQuickReplies(replies);\n\n    return out;\n}\n\n\nexport const confirmOrder = async (pageId, userId) => {\n    await updateOrder({ pageId, userId, confirmOrder: true, calcTotal: true });\n\n    const out = new Elements();\n    out.add({ text: \"Pedido Confirmado!\" });\n    return out;\n}\n\nexport const askForChangeOrder = async (pageId, userId) => {\n    const out = new Elements();\n\n    await updateOrder({ pageId, userId, waitingFor: 'confirmation' });\n\n    let _txt = 'O que voc√™ gostaria de fazer com o seu pedido?';\n    out.add({ text: _txt });\n\n    const replies = new QuickReplies();\n    replies.add({ text: \"Mudar pedido\", data: \"changeOrder\", event: 'ORDER_WANT_CHANGE' });\n    replies.add({ text: \"Mudar endere√ßo\", data: \"change_address\", event: 'ORDER_CHANGE' });\n    replies.add({ text: \"Confirmar.\", data: \"confirmation_yes\", event: 'ORDER_CONFIRMATION' });\n    out.setQuickReplies(replies);\n\n    return out;\n}\n\nexport const askForOptionsToChange = async (pageId, userId, item) => {\n    try {\n        if (item && item.beverageId) {\n            return await askForBeverages(pageId, userId, 1);\n        } else {\n            const out = new Elements();\n\n            let _txt = 'Ok, qual das informa√ß√µes que voc√™ gostaria de alterar?';\n            out.add({ text: _txt });\n\n            const replies = new QuickReplies();\n            // replies.add({ text: \"Quantidade\", data: \"change_quantity\", event: 'ORDER_CHANGE' });\n            replies.add({ text: \"Tamanho\", data: \"change_size\", event: 'ORDER_CHANGE' });\n            replies.add({ text: \"Sabor\", data: \"change_flavor\", event: 'ORDER_CHANGE' });\n            out.setQuickReplies(replies);\n            return out;\n        }\n    } catch (askForOptionsToChangeErr) {\n        console.error({ askForOptionsToChangeErr });\n        throw askForOptionsToChangeErr;\n    }\n}\n\nexport const askForSpecificItem = async (pageId, userId) => {\n    const pendingOrder = await getOrderPending({ pageId, userId, isComplete: true });\n    if (pendingOrder.items && pendingOrder.items.length > 1) {\n        const out = new Elements();\n        out.add({ text: 'Primeiro, escolha qual os itens deseja mudar:' });\n\n        const replies = new QuickReplies();\n        let i = 1;\n        pendingOrder.items.forEach(item => {\n            let _txt = item.flavor ? item.flavor : item.beverage;\n            replies.add({ text: i + \"a. \" + _txt, data: item._id, event: 'ORDER_CHANGE_SELECT_ITEM' });\n            i++;\n        });\n        out.setQuickReplies(replies);\n        return out;\n    } else {\n        await updateOrder({ pageId, userId, completeItem: false });\n        return await askForOptionsToChange(pageId, userId);\n    }\n}\n\n/**\n * \n * @param {*} pageId \n * @param {*} userId \n */\nexport const askForWantBeverage = async (pageId, userId) => {\n    const pendingOrder = await getOrderPending({ pageId, userId, isComplete: false });\n\n    const noBeverage = pendingOrder.order.no_beverage;\n\n    if (typeof noBeverage === 'undefined') {\n\n        const out = new Elements();\n        let _txt = 'Gostaria de algo para beber?';\n        out.add({ text: _txt });\n\n        const replies = new QuickReplies();\n        // replies.add({ text: \"Quantidade\", data: \"change_quantity\", event: 'ORDER_CHANGE' });\n        replies.add({ text: \"Sim\", data: \"beverage_yes\", event: 'ORDER_CONFIRM_BEVERAGE' });\n        replies.add({ text: \"N√£o\", data: \"beverage_no\", event: 'ORDER_CONFIRM_BEVERAGE' });\n        out.setQuickReplies(replies);\n        return out;\n    } else {\n        return showFullOrder(pageId, userId);\n    }\n}\n/**\n * \n * @param {*} pageId \n * @param {*} userId \n * @param {*} multiple \n */\nexport const askForBeverages = async (pageId, userId, multiple) => {\n    const out = new Elements();\n    out.setListStyle('compact'); // or 'large'\n\n    // const po = await getOrderPending({ pageId: pageId, userId: userId, isComplete: false });\n\n    const beveragesArr = await getBeverages(pageId);\n    let _rangeIni = (multiple - 1) * 4;\n    let _rangeEnd = multiple * 4;\n\n    for (let i = _rangeIni; i < _rangeEnd; i++) {\n        if (beveragesArr[i]) {\n            const _bev = beveragesArr[i];\n            const _data = { id: _bev.id, beverage: _bev.name, price: _bev.price }\n            const buttons = new Buttons();\n            buttons.add({ text: 'Quero', data: _data, event: 'ORDER_BEVERAGE' });\n\n            let _subtext = _bev.kind;\n            if (_bev.price) {\n                _subtext = _subtext.concat('\\n R$', _bev.price);\n            }\n            out.add({ text: _bev.name, subtext: _subtext, buttons });\n        }\n    }\n    if ((beveragesArr.length + 1) > _rangeEnd) {\n        multiple++;\n        const buttonsOpt = new Buttons();\n        buttonsOpt.add({ text: '+ Op√ß√µes (clique aqui para ver + op√ß√µes..)', data: { option: \"beverages_more\", multiple: multiple }, event: 'ORDER_BEVERAGE' });\n        out.add({ buttons: buttonsOpt, isOnlyButtons: true });\n    } else {\n        // const lastButton = new Buttons();\n        // lastButton.add({ text: 'N√£o tem, cancelar.', data: { option: \"beverages_cancel\" }, event: 'ORDER_BEVERAGE' });\n        // out.add({ buttons: lastButton, isOnlyButtons: true });\n\n        const _data = { option: 'beverages_cancel' }\n        const buttons = new Buttons();\n        buttons.add({ text: 'Sem bebida', data: _data, event: 'ORDER_BEVERAGE' });\n        let _subtext = 'Se n√£o encontrou, clique em \"Sem bebida\"';\n        out.add({ text: 'N√£o encontrei', subtext: _subtext, buttons });\n    }\n\n    await updateOrder({ pageId, userId, waitingFor: 'beverage', noBeverage: false });\n    return out;\n}\n\n/**\n * Show that user did not want beverage and update order with this info.\n * @param {*} pageId \n * @param {*} userId \n * @param {*} data \n */\nexport const showNoBeverage = async (pageId, userId, data) => {\n    await updateOrder({ pageId, userId, noBeverage: true, waitingFor: 'confirm' });\n\n    const out = new Elements();\n    out.add({ text: '‚ùå ' + ' Sem bebida para o seu pedido. ' });\n    return out;\n}\n\n/**\n * Show the chosen beverage.\n * @param {*} pageId \n * @param {*} userId \n * @param {*} data \n */\nexport const showBeverage = async (pageId, userId, data) => {\n    await updateOrder({ pageId, userId, beverageId: data.id, beveragePrice: data.price, completeItem: true, noBeverage: false, waitingFor: 'confirmation', calcTotal: true });\n\n    const out = new Elements();\n    out.add({ text: '‚úÖ ' + '1 Bebida: ' + data.beverage });\n    return out;\n}\n\nexport const updateItemAskOptions = async (pageId, userId, objectId) => {\n    const item = await updateStatusSpecificItem(objectId, 0);\n    return await askForOptionsToChange(pageId, userId, item);\n}\n\nexport const sendShippingNotification = async (pageId, userId, orderId) => {\n    const { accessToken } = await getOnePageToken(pageId);\n\n    const _txt = 'O seu pedido n√∫mero ' + orderId + ' acabou de sair para entrega. Bom apetite!';\n\n    const out = new Elements();\n    out.add({ text: _txt });\n    await Bot.send_message_tag(accessToken, userId, out);\n}\n\n\n\n"],"file":"botController.js"}