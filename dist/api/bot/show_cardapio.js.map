{"version":3,"sources":["../../../src/api/bot/show_cardapio.js"],"names":["getCardapio","pageID","categoryID","category","getFlavorsAndToppingsCardapio","flavorArray","pricingArray","price_by_size","replyText","name","pricing","categoryId","id","size","price","inputCardapioReplyMsg","askForCategoryCardapio","pageId","storeData","catalog_url1","catalog_url2","_images","img","imageUrl","imageCaption","push","reply","extraType","images","categories","_txt","_options","item","_data","buttons","text","data","event","subtext","type","options","allToppings","flavorsWithToppings","flavor","toppingsNames","toppings","length","tId","topping","console","error","flavorsAndToppingsCardapioErr","priceBySize","info","replyMsg","join"],"mappings":"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","sourcesContent":["import { getPricingsWithSize } from '../controllers/pricingsController';\nimport { getCategories, getCategory } from '../controllers/categoriesController';\nimport { getFlavors } from '../controllers/flavorsController';\nimport { getToppingsFull } from '../controllers/toppingsController';\nimport { getStoreData } from '../controllers/storesController';\nimport { sendMainMenu } from './botController';\n\nexport const getCardapio = async (pageID, categoryID) => {\n    const category = await getCategory(pageID, categoryID);\n    const flavorArray = await getFlavorsAndToppingsCardapio(pageID, categoryID);\n\n    let pricingArray = []\n    if (category && category.price_by_size)\n        pricingArray = await getPricingsWithSize(pageID);\n\n    let replyText;\n\n    if (flavorArray && category) {\n        replyText = `Seguem nossas opções de ${category.name}:\\n`;\n        if (category && category.price_by_size) {\n            for (const pricing of pricingArray) {\n                if (pricing.categoryId === category.id)\n                    replyText = replyText + `${pricing.size} - R$ ${pricing.price}\\n`;\n            }\n        }\n        replyText = replyText + '\\n' + await inputCardapioReplyMsg(flavorArray, category.price_by_size);\n    }\n    return replyText;\n}\n\n/**\n * If there is an image in the Store Customizing, send it.\n * @param {*} pageId\n */\nexport const askForCategoryCardapio = async (pageId) => {\n    const storeData = await getStoreData(pageId);\n\n    if (storeData.catalog_url1 || storeData.catalog_url2) {\n        const _images = [];\n        if (storeData.catalog_url1) {\n            const img = { imageUrl: storeData.catalog_url1, imageCaption: 'Cardápio' };\n            _images.push(img);\n        }\n        if (storeData.catalog_url2) {\n            const img = { imageUrl: storeData.catalog_url2, imageCaption: 'Cardápio' };\n            _images.push(img);\n        }\n\n        const reply = await sendMainMenu();\n        reply.extraType = 'image';\n        reply.images = _images;\n\n        return reply;\n\n    } else {\n        const categories = await getCategories(pageId);\n\n        let _txt = 'Selecione uma categoria:';\n\n        const _options = [];\n        for (let item of categories) {\n            const _data = { id: item.id, name: item.name }\n            const buttons = { text: 'Detalhes', data: _data, event: 'ORDER_CATEGORY_CARDAPIO' };\n            _options.push({ text: item.name, subtext: item.name, buttons });\n        }\n\n        const buttons = { text: 'Voltar', data: 'main_menu', event: 'MAIN_MENU' };\n        _options.push({ text: 'Voltar p/ Inicio', subtext: 'Voltar p/ Inicio', buttons });\n\n        return {\n            type: 'list',\n            text: _txt,\n            options: _options,\n        }\n    }\n}\n\nexport const getFlavorsAndToppingsCardapio = async (pageID, categoryID) => {\n    try {\n        const flavorArray = await getFlavors(pageID);\n        const allToppings = await getToppingsFull(pageID);\n        const flavorsWithToppings = [];\n        for (let flavor of flavorArray) {\n            if (categoryID && flavor.categoryId === categoryID) {\n                flavor.toppingsNames = [];\n                if (flavor.toppings && flavor.toppings.length > 0) {\n                    for (let tId of flavor.toppings) {\n                        for (let topping of allToppings) {\n                            if (topping.id === tId) {\n                                flavor.toppingsNames.push(topping.topping);\n                            }\n                        }\n                    }\n                }\n                flavorsWithToppings.push(flavor);\n            }\n        }\n        return flavorsWithToppings;\n    } catch (err) {\n        console.error({ flavorsAndToppingsCardapioErr: err });\n    }\n}\n\nexport const inputCardapioReplyMsg = async (flavorArray, priceBySize) => {\n    console.info(flavorArray);\n    let replyMsg = '';\n    if (flavorArray) {\n        for (const flavor of flavorArray) {\n            replyMsg = replyMsg + '*' + flavor.flavor + '*';\n            if (!priceBySize)\n                replyMsg = replyMsg + ' - RS ' + flavor.price;\n            replyMsg = replyMsg + '\\n';\n\n            if (flavor.toppingsNames && flavor.toppingsNames.length > 0)\n                replyMsg = replyMsg + flavor.toppingsNames.join(', ') + '\\n';\n        }\n    }\n    return replyMsg;\n}\n"],"file":"show_cardapio.js"}