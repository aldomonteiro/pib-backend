{"version":3,"sources":["../../../src/api/controllers/authenticate.js"],"names":["req","res","next","header","headers","authorization","token","split","jwt","verify","process","env","JWT_SECRET","err","decoded","status","json","message","User","findOne","email","then","user","currentUser"],"mappings":";;;;;;;AAAA;;AACA;;;;eAEe,kBAACA,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC/B,MAAMC,MAAM,GAAGH,GAAG,CAACI,OAAJ,CAAYC,aAA3B;AACA,MAAIC,KAAJ,CAF+B,CAI/B;AACA;;AACA,MAAIH,MAAJ,EAAYG,KAAK,GAAGH,MAAM,CAACI,KAAP,CAAa,GAAb,EAAkB,CAAlB,CAAR;;AAEZ,MAAID,KAAJ,EAAW;AACPE,6BAAIC,MAAJ,CAAWH,KAAX,EAAkBI,OAAO,CAACC,GAAR,CAAYC,UAA9B,EAA0C,UAACC,GAAD,EAAMC,OAAN,EAAkB;AACxD,UAAID,GAAJ,EAAS;AACLZ,QAAAA,GAAG,CAACc,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,UAAAA,OAAO,EAAE;AAAX,SAArB;AACH,OAFD,MAEO;AACHC,0BAAKC,OAAL,CAAa;AAAEC,UAAAA,KAAK,EAAEN,OAAO,CAACM;AAAjB,SAAb,EAAuCC,IAAvC,CAA4C,UAAAC,IAAI,EAAI;AAChDtB,UAAAA,GAAG,CAACuB,WAAJ,GAAkBD,IAAlB;AACApB,UAAAA,IAAI;AACP,SAHD;AAIH;AACJ,KATD;AAUH,GAXD,MAWO;AACHD,IAAAA,GAAG,CAACc,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,MAAAA,OAAO,EAAE;AAAX,KAArB;AACH;AACJ,C","sourcesContent":["import jwt from 'jsonwebtoken';\nimport User from '../models/users';\n\nexport default (req, res, next) => {\n    const header = req.headers.authorization;\n    let token;\n\n    // in pib-frontend App.js\n    // options.headers.set('Authorization', `Bearer ${token}`);\n    if (header) token = header.split(' ')[1];\n\n    if (token) {\n        jwt.verify(token, process.env.JWT_SECRET, (err, decoded) => {\n            if (err) {\n                res.status(401).json({ message: 'pos.auth.invalid_token' });\n            } else {\n                User.findOne({ email: decoded.email }).then(user => {\n                    req.currentUser = user;\n                    next();\n                });\n            }\n        });\n    } else {\n        res.status(401).json({ message: 'No token' });\n    }\n};\n"],"file":"authenticate.js"}