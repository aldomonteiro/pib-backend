{"version":3,"sources":["../../../src/api/controllers/authenticate.js"],"names":["req","res","next","header","headers","authorization","token","split","jwt","verify","process","env","JWT_SECRET","err","decoded","status","json","message","User","findOne","email","then","user","currentUser"],"mappings":"oGAAA;AACA,gE;;AAEe,kBAACA,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC/B,MAAMC,MAAM,GAAGH,GAAG,CAACI,OAAJ,CAAYC,aAA3B;AACA,MAAIC,KAAJ;;AAEA;AACA;AACA,MAAIH,MAAJ,EAAYG,KAAK,GAAGH,MAAM,CAACI,KAAP,CAAa,GAAb,EAAkB,CAAlB,CAAR;;AAEZ,MAAID,KAAJ,EAAW;AACPE,0BAAIC,MAAJ,CAAWH,KAAX,EAAkBI,OAAO,CAACC,GAAR,CAAYC,UAA9B,EAA0C,UAACC,GAAD,EAAMC,OAAN,EAAkB;AACxD,UAAID,GAAJ,EAAS;AACLZ,QAAAA,GAAG,CAACc,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEC,OAAO,EAAE,wBAAX,EAArB;AACH,OAFD,MAEO;AACHC,uBAAKC,OAAL,CAAa,EAAEC,KAAK,EAAEN,OAAO,CAACM,KAAjB,EAAb,EAAuCC,IAAvC,CAA4C,UAAAC,IAAI,EAAI;AAChDtB,UAAAA,GAAG,CAACuB,WAAJ,GAAkBD,IAAlB;AACApB,UAAAA,IAAI;AACP,SAHD;AAIH;AACJ,KATD;AAUH,GAXD,MAWO;AACHD,IAAAA,GAAG,CAACc,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEC,OAAO,EAAE,UAAX,EAArB;AACH;AACJ,C","sourcesContent":["import jwt from \"jsonwebtoken\";\nimport User from \"../models/users\";\n\nexport default (req, res, next) => {\n    const header = req.headers.authorization;\n    let token;\n\n    // in pib-frontend App.js\n    // options.headers.set('Authorization', `Bearer ${token}`);\n    if (header) token = header.split(\" \")[1];\n\n    if (token) {\n        jwt.verify(token, process.env.JWT_SECRET, (err, decoded) => {\n            if (err) {\n                res.status(401).json({ message: \"pos.auth.invalid_token\" });\n            } else {\n                User.findOne({ email: decoded.email }).then(user => {\n                    req.currentUser = user;\n                    next();\n                });\n            }\n        });\n    } else {\n        res.status(401).json({ message: \"No token\" });\n    }\n};"],"file":"authenticate.js"}