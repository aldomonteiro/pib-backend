{"version":3,"sources":["../../../src/api/controllers/beveragesController.js"],"names":["beverage_get_all","req","res","sortObj","query","sort","name","rangeObj","range","queryObj","filter","filterObj","filterField","length","i","value","filterValues","Array","isArray","$in","currentUser","activePage","Beverage","find","exec","err","result","status","json","message","errmsg","_rangeIni","_rangeEnd","offset","limit","_totalCount","responseArr","push","setHeader","util","format","beverage_get_one","params","id","pageId","findOne","doc","beverage_create","body","newRecord","kind","price","save","then","catch","beverage_update","beverage_delete","findOneAndRemove","deleteManyBeverages","pageID","deleteMany","getBeverages","getBeverage","beverageID"],"mappings":"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","sourcesContent":["\nimport Beverage from '../models/beverages';\nimport util from 'util';\nimport { configSortQuery, configRangeQuery, configFilterQueryMultiple } from '../util/util';\n\n// List all records\nexport const beverage_get_all = (req, res) => {\n    // Getting the sort from the requisition\n    let sortObj = req.query.sort ? configSortQuery(req.query.sort) : { name: 'ASC' };\n    // Getting the range from the requisition\n    let rangeObj = configRangeQuery(req.query.range);\n\n    let queryObj = {};\n    if (req.query.filter) {\n        const filterObj = configFilterQueryMultiple(req.query.filter);\n\n        if (filterObj && filterObj.filterField && filterObj.filterField.length) {\n            for (let i = 0; i < filterObj.filterField.length; i++) {\n                const filter = filterObj.filterField[i];\n                const value = filterObj.filterValues[i];\n                if (Array.isArray(value)) {\n                    queryObj[filter] = { $in: value };\n                } else\n                    queryObj[filter] = value;\n            }\n        }\n    }\n    if (req.currentUser.activePage) {\n        queryObj['pageId'] = req.currentUser.activePage;\n    }\n\n    Beverage.find(queryObj).sort(sortObj).exec((err, result) => {\n        if (err) {\n            res.status(500).json({ message: err.errmsg });\n        } else {\n            let _rangeIni = 0;\n            let _rangeEnd = result.length;\n            if (rangeObj) {\n                _rangeIni = rangeObj.offset <= result.length ? rangeObj.offset : result.length;\n                _rangeEnd = (rangeObj.offset + rangeObj.limit) <= result.length ? rangeObj.offset + rangeObj.limit : result.length;\n            }\n            let _totalCount = result.length;\n            let responseArr = [];\n            for (let i = _rangeIni; i < _rangeEnd; i++) {\n                responseArr.push(result[i])\n            }\n            res.setHeader('Content-Range', util.format('beverages %d-%d/%d', _rangeIni, _rangeEnd, _totalCount));\n            res.status(200).json(responseArr);\n        }\n    });\n};\n\n// List one record by filtering by ID\nexport const beverage_get_one = (req, res) => {\n    if (req.params && req.params.id) {\n        // Filter based on the currentUser\n        const pageId = req.currentUser.activePage;\n\n        Beverage.findOne({ pageId: pageId, id: req.params.id }, (err, doc) => {\n            if (err) {\n                res.status(500).json({ message: err.errmsg });\n            }\n            else {\n                res.status(200).json(doc);\n            }\n        });\n    }\n}\n\n// CREATE A NEW RECORD\nexport const beverage_create = (req, res) => {\n    if (req.body) {\n\n        const pageId = req.currentUser.activePage ? req.currentUser.activePage : null;\n\n        const newRecord = new Beverage({\n            id: req.body.id,\n            kind: req.body.kind,\n            name: req.body.name,\n            price: req.body.price,\n            pageId: pageId,\n        });\n\n        newRecord.save()\n            .then((result) => {\n                res.status(200).json(result);\n            })\n            .catch((err) => {\n                res.status(500).json({ message: err.errmsg });\n            });\n    }\n}\n\n// UPDATE\nexport const beverage_update = (req, res) => {\n    if (req.body && req.body.id) {\n\n        const pageId = req.currentUser.activePage;\n\n        Beverage.findOne({ pageId: pageId, id: req.body.id }, (err, doc) => {\n            if (!err) {\n                doc.kind = req.body.kind;\n                doc.name = req.body.name;\n                doc.price = req.body.price;\n\n                doc.save((err, result) => {\n                    if (err) {\n                        res.status(500).json({ message: err.errmsg });\n                    } else {\n                        res.status(200).json(result);\n                    }\n                });\n            } else {\n                res.status(500).json({ message: err.errmsg });\n            }\n        });\n    }\n}\n\n// DELETE\nexport const beverage_delete = (req, res) => {\n\n    const pageId = req.currentUser.activePage;\n\n    Beverage.findOneAndRemove({ pageId: pageId, id: req.params.id })\n        .then((result) => {\n            res.status(200).json(result);\n        })\n        .catch((err) => {\n            res.status(500).json({ message: err.errmsg });\n        });\n};\n\n/**\n * Delete all records from a pageID\n * @param {*} pageID\n */\nexport const deleteManyBeverages = async (pageID) => {\n    return await Beverage.deleteMany({ pageId: pageID }).exec();\n}\n\n\nexport const getBeverages = async (pageID) => {\n    let query = Beverage.find({ pageId: pageID });\n    query.sort('name kind');\n    return await query.exec();\n}\n\nexport const getBeverage = async (pageID, beverageID) => {\n    const query = Beverage.findOne({ pageId: pageID, id: beverageID });\n    // query.select('id name kind price');\n    return await query.exec();\n}\n\n"],"file":"beveragesController.js"}