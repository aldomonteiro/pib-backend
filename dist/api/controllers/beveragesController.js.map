{"version":3,"sources":["../../../src/api/controllers/beveragesController.js"],"names":["beverage_get_all","req","res","sortObj","query","sort","rangeObj","range","options","offset","limit","lean","leanWithId","currentUser","activePage","Beverage","find","pageId","paginate","err","result","status","json","message","errmsg","setHeader","util","format","total","docs","beverage_get_one","params","id","findOne","doc","beverage_create","body","newRecord","kind","name","price","save","then","catch","beverage_update","beverage_delete","findOneAndRemove","deleteManyBeverages","pageID","deleteMany","exec","getBeverages","getBeverage","beverageID"],"mappings":"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","sourcesContent":["\nimport Beverage from \"../models/beverages\";\nimport util from \"util\";\nimport { configSortQuery, configRangeQuery } from '../util/util';\n\n// List all records\n// TODO: use filters in the query req.query\nexport const beverage_get_all = (req, res) => {\n    // Getting the sort from the requisition\n    var sortObj = configSortQuery(req.query.sort);\n    // Getting the range from the requisition\n    var rangeObj = configRangeQuery(req.query.range);\n\n    let options = {\n        offset: rangeObj['offset'],\n        limit: rangeObj['limit'],\n        sort: sortObj,\n        lean: true,\n        leanWithId: false,\n    };\n\n    var query = {};\n\n    if (req.currentUser.activePage) {\n        query = Beverage.find({ pageId: req.currentUser.activePage });\n    }\n\n    Beverage.paginate(query, options, (err, result) => {\n        if (err) {\n            res.status(500).json({ message: err.errmsg });\n        } else {\n            res.setHeader('Content-Range', util.format(\"beverages %d-%d/%d\", rangeObj['offset'], rangeObj['limit'], result.total));\n            res.status(200).json(result.docs);\n        }\n    });\n};\n\n// List one record by filtering by ID\nexport const beverage_get_one = (req, res) => {\n    if (req.params && req.params.id) {\n        // Filter based on the currentUser\n        const pageId = req.currentUser.activePage;\n\n        Beverage.findOne({ pageId: pageId, id: req.params.id }, (err, doc) => {\n            if (err) {\n                res.status(500).json({ message: err.errmsg });\n            }\n            else {\n                res.status(200).json(doc);\n            }\n        });\n    }\n}\n\n// CREATE A NEW RECORD\nexport const beverage_create = (req, res) => {\n    if (req.body) {\n\n        const pageId = req.currentUser.activePage ? req.currentUser.activePage : null;\n\n        const newRecord = new Beverage({\n            id: req.body.id,\n            kind: req.body.kind,\n            name: req.body.name,\n            price: req.body.price,\n            pageId: pageId,\n        });\n\n        newRecord.save()\n            .then((result) => {\n                res.status(200).json(result);\n            })\n            .catch((err) => {\n                res.status(500).json({ message: err.errmsg });\n            });\n    }\n}\n\n// UPDATE\nexport const beverage_update = (req, res) => {\n    if (req.body && req.body.id) {\n\n        const pageId = req.currentUser.activePage;\n\n        Beverage.findOne({ pageId: pageId, id: req.body.id }, (err, doc) => {\n            if (!err) {\n                doc.kind = req.body.kind;\n                doc.name = req.body.name;\n                doc.price = req.body.price;\n\n                doc.save((err, result) => {\n                    if (err) {\n                        res.status(500).json({ message: err.errmsg });\n                    } else {\n                        res.status(200).json(result);\n                    }\n                });\n            } else {\n                res.status(500).json({ message: err.errmsg });\n            }\n        });\n    }\n}\n\n// DELETE\nexport const beverage_delete = (req, res) => {\n\n    const pageId = req.currentUser.activePage;\n\n    Beverage.findOneAndRemove({ pageId: pageId, id: req.params.id })\n        .then((result) => {\n            res.status(200).json(result);\n        })\n        .catch((err) => {\n            res.status(500).json({ message: err.errmsg });\n        });\n};\n\n/**\n * Delete all records from a pageID\n * @param {*} pageID \n */\nexport const deleteManyBeverages = async (pageID) => {\n    return await Beverage.deleteMany({ pageId: pageID }).exec();\n}\n\n\nexport const getBeverages = async (pageID) => {\n    let query = Beverage.find({ pageId: pageID });\n    query.sort('name kind');\n    return await query.exec();\n}\n\nexport const getBeverage = async (pageID, beverageID) => {\n    const query = Beverage.findOne({ pageId: pageID, id: beverageID });\n    // query.select('id name kind price');\n    return await query.exec();\n}\n\n"],"file":"beveragesController.js"}