{"version":3,"sources":["../../../src/api/controllers/categoriesController.js"],"names":["category_get_all","req","res","sortObj","query","sort","name","rangeObj","range","queryObj","filter","filterObj","filterField","length","i","value","filterValues","Array","isArray","$in","currentUser","activePage","Category","find","exec","err","result","status","json","message","errmsg","_rangeIni","_rangeEnd","offset","limit","_totalCount","responseArr","push","setHeader","util","format","category_get_one","params","id","pageId","findOne","doc","category_create","body","pageID","select","lastId","newRecord","price_by_size","is_pizza","save","then","catch","category_update","category_delete","findOneAndRemove","deleteManyCategories","deleteMany","getCategories","getCategory","categoryID"],"mappings":"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","sourcesContent":["\nimport Category from '../models/categories';\nimport util from 'util';\nimport { configSortQuery, configRangeQuery, configFilterQueryMultiple } from '../util/util';\n\n// List all records\nexport const category_get_all = (req, res) => {\n    // Getting the sort from the requisition\n    let sortObj = req.query.sort ? configSortQuery(req.query.sort) : { name: 'ASC' };\n    // Getting the range from the requisition\n    let rangeObj = configRangeQuery(req.query.range);\n\n    let queryObj = {};\n    if (req.query.filter) {\n        const filterObj = configFilterQueryMultiple(req.query.filter);\n\n        if (filterObj && filterObj.filterField && filterObj.filterField.length) {\n            for (let i = 0; i < filterObj.filterField.length; i++) {\n                const filter = filterObj.filterField[i];\n                const value = filterObj.filterValues[i];\n                if (Array.isArray(value)) {\n                    queryObj[filter] = { $in: value };\n                } else\n                    queryObj[filter] = value;\n            }\n        }\n    }\n    if (req.currentUser.activePage) {\n        queryObj['pageId'] = req.currentUser.activePage;\n    }\n\n    Category.find(queryObj).sort(sortObj).exec((err, result) => {\n        if (err) {\n            res.status(500).json({ message: err.errmsg });\n        } else {\n            let _rangeIni = 0;\n            let _rangeEnd = result.length;\n            if (rangeObj) {\n                _rangeIni = rangeObj.offset <= result.length ? rangeObj.offset : result.length;\n                _rangeEnd = (rangeObj.offset + rangeObj.limit) <= result.length ? rangeObj.offset + rangeObj.limit : result.length;\n            }\n            let _totalCount = result.length;\n            let responseArr = [];\n            for (let i = _rangeIni; i < _rangeEnd; i++) {\n                responseArr.push(result[i])\n            }\n            res.setHeader('Content-Range', util.format('categories %d-%d/%d', _rangeIni, _rangeEnd, _totalCount));\n            res.status(200).json(responseArr);\n        }\n    });\n};\n\n// List one record by filtering by ID\nexport const category_get_one = (req, res) => {\n    if (req.params && req.params.id) {\n        // Filter based on the currentUser\n        const pageId = req.currentUser.activePage;\n\n        Category.findOne({ pageId: pageId, id: req.params.id }, (err, doc) => {\n            if (err) {\n                res.status(500).json({ message: err.errmsg });\n            }\n            else {\n                res.status(200).json(doc);\n            }\n        });\n    }\n}\n\n// CREATE A NEW RECORD\nexport const category_create = async (req, res) => {\n    if (req.body) {\n\n        const pageID = req.currentUser.activePage ? req.currentUser.activePage : null;\n\n        let { id } = req.body;\n\n        if (!id || id === 0) {\n            const lastId = await Category.find({ pageId: pageID }).select('id').sort('-id').limit(1).exec();\n            id = 1;\n            if (lastId && lastId.length)\n                id = lastId[0].id + 1;\n        }\n\n        const newRecord = new Category({\n            id: id,\n            name: req.body.name,\n            price_by_size: req.body.price_by_size,\n            is_pizza: req.body.is_pizza,\n            pageId: pageID,\n        });\n\n        newRecord.save()\n            .then((result) => {\n                res.status(200).json(result);\n            })\n            .catch((err) => {\n                res.status(500).json({ message: err.errmsg });\n            });\n    }\n}\n\n// UPDATE\nexport const category_update = (req, res) => {\n    if (req.body && req.body.id) {\n\n        const pageId = req.currentUser.activePage;\n\n        Category.findOne({ pageId: pageId, id: req.body.id }, (err, doc) => {\n            if (!err) {\n                doc.name = req.body.name;\n                doc.price_by_size = req.body.price_by_size;\n                doc.is_pizza = req.body.is_pizza;\n                doc.save((err, result) => {\n                    if (err) {\n                        res.status(500).json({ message: err.errmsg });\n                    } else {\n                        res.status(200).json(result);\n                    }\n                });\n            } else {\n                res.status(500).json({ message: err.errmsg });\n            }\n        });\n    }\n}\n\n// DELETE\nexport const category_delete = (req, res) => {\n\n    const pageId = req.currentUser.activePage;\n\n    Category.findOneAndRemove({ pageId: pageId, id: req.params.id })\n        .then((result) => {\n            res.status(200).json(result);\n        })\n        .catch((err) => {\n            res.status(500).json({ message: err.errmsg });\n        });\n};\n\n/**\n * Delete all records from a pageID\n * @param {*} pageID\n */\nexport const deleteManyCategories = async (pageID) => {\n    return await Category.deleteMany({ pageId: pageID }).exec();\n}\n\nexport const getCategories = async (pageID) => {\n    let query = Category.find({ pageId: pageID });\n    query.sort('id');\n    return await query.exec();\n}\n\nexport const getCategory = async (pageID, categoryID) => {\n    const query = Category.findOne({ pageId: pageID, id: categoryID });\n    return await query.exec();\n}\n\n"],"file":"categoriesController.js"}