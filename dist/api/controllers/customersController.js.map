{"version":3,"sources":["../../../src/api/controllers/customersController.js"],"names":["checkCustomerAddress","pageID","userID","location","getCustomerAddress","addressData","getAddressLocation","status","Customer","findOne","pageId","userId","exec","customer","addr_formatted","addr_street","formattedAddress","street","street_number","addr_streetnumber","sublocality","addr_sublocality","state","addr_state","city","addr_city","postal_code","addr_postalcode","googleMapsAPI","process","env","GOOGLE_MAPS_APIKEY","response","console","info","data","error_message","GOOGLE_MAPS_APIKEY2","response2","GOOGLE_MAPS_APIKEY3","response3","GOOGLE_MAPS_APIKEY4","response4","MY_GOOGLE_MAPS_APIKEY","response5","error","statusText","results","API_KEY","axios","get","params","lat","long","customer_update","custData","id","first_name","last_name","phone","profile_pic","addrData","updateDb","profilePic","location_lat","location_long","location_url","url","manual_address","addr_manual","save","err","result","resultLastId","find","select","sort","limit","lastId","length","newRecord","email","addr","formatAddrData","formattedAddressData","formatted_address","addComps","address_components","forEach","element","types","type","long_name"],"mappings":"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","sourcesContent":["import Customer from '../models/customers';\nimport axios from 'axios';\n\nexport const checkCustomerAddress = async (pageID, userID, location) => {\n    let addressData = await getCustomerAddress(pageID, userID);\n    if (addressData) {\n        return addressData;\n    } else {\n        addressData = await getAddressLocation(location);\n        if (addressData.status === 200) {\n            return addressData;\n        }\n        else return null;\n    }\n}\n\nexport const getCustomerAddress = async (pageID, userID) => {\n\n    const customer = await Customer.findOne({ pageId: pageID, userId: userID }).exec();\n\n    if (customer) {\n        if (customer.addr_formatted || customer.addr_street) {\n            let addressData = {};\n            addressData.formattedAddress = customer.addr_formatted;\n            addressData.street = customer.addr_street;\n            addressData.street_number = customer.addr_streetnumber;\n            addressData.sublocality = customer.addr_sublocality;\n            addressData.state = customer.addr_state;\n            addressData.city = customer.addr_city;\n            addressData.postal_code = customer.addr_postalcode;\n            return addressData;\n        } else return null;\n    } else return null;\n}\n\nexport const getAddressLocation = async (location) => {\n    const response = await googleMapsAPI(location, process.env.GOOGLE_MAPS_APIKEY);\n    console.info({ response });\n    if (response.status === 200) {\n        if (response.data.error_message && response.data.status === 'OVER_QUERY_LIMIT') {\n            const response2 = await googleMapsAPI(location, process.env.GOOGLE_MAPS_APIKEY2);\n            if (response2.status === 200) {\n                if (response2.data.error_message && response2.data.status === 'OVER_QUERY_LIMIT') {\n                    const response3 = await googleMapsAPI(location, process.env.GOOGLE_MAPS_APIKEY3);\n                    if (response3.status === 200) {\n                        if (response3.data.error_message && response3.data.status === 'OVER_QUERY_LIMIT') {\n                            const response4 = await googleMapsAPI(location, process.env.GOOGLE_MAPS_APIKEY4);\n                            if (response4.status === 200) {\n                                if (response4.data.error_message && response4.data.status === 'OVER_QUERY_LIMIT') {\n                                    const response5 = await googleMapsAPI(location, process.env.MY_GOOGLE_MAPS_APIKEY);\n                                    if (response5.status === 200) {\n                                        if (response5.data.error_message && response5.data.status === 'OVER_QUERY_LIMIT') {\n                                            console.error(response5.status, response5.statusText);\n                                            return null;\n                                        } else return response5.data.results;\n                                    } else return null;\n                                } else return response4.data.results;\n                            } else return null;\n                        } else return response3.data.results;\n                    } else return null;\n                } else return response2.data.results;\n            } else return null;\n        } else return response.data.results;\n    } else return null;\n}\n\nconst googleMapsAPI = async (location, API_KEY) => {\n    console.info('using:' + API_KEY);\n    return await axios.get('https://maps.googleapis.com/maps/api/geocode/json', {\n        params: {\n            'latlng': location.lat + ',' + location.long,\n            'key': API_KEY,\n        }\n    });\n}\n\nexport const customer_update = async (custData) => {\n\n    const customer = await Customer.findOne({ pageId: custData.pageId, userId: custData.userId }).exec();\n\n    if (customer && customer.id) {\n        const { first_name, last_name, phone, profile_pic, location, addrData } = custData;\n\n        let updateDb = false;\n        if (first_name || last_name) {\n            customer.first_name = first_name;\n            customer.last_name = last_name;\n            updateDb = true;\n        }\n        if (profile_pic) {\n            customer.profilePic = profile_pic;\n            updateDb = true;\n        }\n        if (phone) {\n            customer.phone = phone;\n            updateDb = true;\n        }\n        if (location) {\n            customer.location_lat = location.lat;\n            customer.location_long = location.long;\n            customer.location_url = location.url;\n            updateDb = true;\n        }\n        if (addrData) {\n            if (addrData.manual_address)\n                customer.addr_manual = true;\n            else\n                customer.addr_manual = false;\n\n            customer.addr_formatted = addrData.formattedAddress;\n            customer.addr_street = addrData.street;\n            customer.addr_sublocality = addrData.sublocality;\n            customer.addr_streetnumber = addrData.street_number;\n            customer.addr_state = addrData.state;\n            customer.addr_city = addrData.city;\n            customer.addr_postalcode = addrData.postal_code;\n            updateDb = true;\n        }\n\n        if (updateDb) {\n            await customer.save((err, result) => {\n                if (err) throw err;\n            });\n        }\n    } else {\n        const resultLastId = Customer.find({ pageId: custData.pageId })\n            .select('id')\n            .sort('-id')\n            .limit(1)\n            .exec();\n        let lastId = 0;\n        if (resultLastId && resultLastId.length) lastId = resultLastId[0];\n\n        const newRecord = new Customer({\n            id: lastId + 1,\n            userId: custData.userId,\n            pageId: custData.pageId,\n            first_name: custData.first_name,\n            last_name: custData.last_name,\n            profilePic: custData.profile_pic,\n            email: custData.email,\n            phone: custData.phone,\n            addr_formatted: custData.addr ? custData.addr.formattedAddress : null,\n            addr_street: custData.addr ? custData.addr.street : null,\n            addr_sublocality: custData.addr ? custData.addr.sublocality : null,\n            addr_streetnumber: custData.addr ? custData.addr.street_number : null,\n            addr_state: custData.addr ? custData.addr.state : null,\n            addr_city: custData.addr ? custData.addr.city : null,\n            addr_postalcode: custData.addr ? custData.addr.postal_code : null,\n            location_lat: custData.location ? custData.location.lat : null,\n            location_long: custData.location ? custData.location.long : null,\n            location_url: custData.location ? custData.location.url : null,\n        });\n\n        newRecord.save((err, result) => {\n            if (err) throw err;\n        });\n    }\n}\n\nexport const formatAddrData = async addrData => {\n    let formattedAddressData = {}\n    formattedAddressData.formattedAddress = addrData.formatted_address;\n    const addComps = addrData.address_components;\n\n    addComps.forEach(element => {\n        element.types.forEach(type => {\n            if (type === 'street_number') {\n                formattedAddressData.street_number = element.long_name;\n            } else if (type === 'route') {\n                formattedAddressData.street = element.long_name;\n            } else if (type === 'sublocality' || type === 'sublocality_level_1') {\n                formattedAddressData.sublocality = element.long_name;\n            } else if (type === 'administrative_area_level_2') {\n                formattedAddressData.city = element.long_name;\n            } else if (type === 'administrative_area_level_1') {\n                formattedAddressData.state = element.long_name;\n            } else if (type === 'postal_code') {\n                formattedAddressData.postal_code = element.long_name;\n            }\n        });\n    });\n    return formattedAddressData;\n}\n\n\n"],"file":"customersController.js"}