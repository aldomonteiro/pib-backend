{"version":3,"sources":["../src/server-bot.js"],"names":["dotenv","config","RETRY_TIMEOUT","options","useNewUrlParser","autoReconnect","keepAlive","reconnectInterval","reconnectTries","isConnectedBefore","connect","mongoose","process","env","MONGODB_URL","catch","err","console","error","set","Promise","connection","on","setTimeout","info","close","warn","exit","global","pagesKeyID","Object","app","bot","Bot","FB_VERIFY_TOKEN","logger","token","req","res","tz","format","use","bodyParser","urlencoded","extended","json","next","doNext","body","object","entry","length","pageID","id","timerIdentifier","Math","random","time","accessToken","name","timeEnd","expressAppUseGetTokenError","log","router","listen","FB_WEBHOOK_PORT","message","sender","startTyping","recipient","out1","wait","stopTyping","send","out2","outError","event","data","out","fetchUser","user","answer","mainMenuError","location","text","onMessageError","quick_reply","payload","quickReplyError","split","Number","option","multiple","summary","orderConfirmationError"],"mappings":"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","sourcesContent":["import \"@babel/polyfill\";\nimport express from \"express\";\nimport logger from \"morgan\";\nimport bodyParser from \"body-parser\";\nimport dotenv from \"dotenv\";\nimport moment from 'moment-timezone';\nimport mongoose from 'mongoose';\nimport { Bot, Elements, Buttons, QuickReplies } from 'facebook-messenger-bot';\nimport { getOnePageToken, getAllPages, getOnePageData } from './api/controllers/pagesController';\nimport { getPricingSizing } from './api/controllers/pricingsController';\nimport getCardapio from './api/bot/show_cardapio';\nimport { choices_sizes } from './api/util/util';\nimport {\n  sendWelcomeMessage,\n  sendErrorMsg,\n  sendMainMenu,\n  sendCardapio,\n  askForPhone,\n  showPhone,\n  askToTypePhone,\n  askForQuantity,\n  askForQuantityMore,\n  showQuantity,\n  askForSize,\n  showSize,\n  askForFlavor,\n  showFlavor,\n  showOrderOrNextItem,\n  askForLocation,\n  confirmAddressOrAskLocation,\n  confirmLocationAddress,\n  showAddress,\n  confirmOrder,\n  askToTypeAddress,\n  confirmTypedText,\n  sendHorario,\n  basicReply,\n  askForChangeOrder,\n  askForSplitFlavorOrConfirm,\n  askForFlavorOrConfirm,\n  askForSpecificItem,\n  updateItemAskOptions,\n  showOrderOrAskForPhone,\n  showSplit\n} from './api/bot/botController';\n\ndotenv.config();\n\n// mongoose.connect(\n//   process.env.MONGODB_URL,\n//   { useNewUrlParser: true }\n// );\n\nconst RETRY_TIMEOUT = 3000\n\nconst options = {\n  useNewUrlParser: true,\n  autoReconnect: true,\n  keepAlive: 30000,\n  reconnectInterval: RETRY_TIMEOUT,\n  reconnectTries: 10000\n}\n\nlet isConnectedBefore = false\n\nconst connect = () => {\n  return mongoose.connect(process.env.MONGODB_URL, options)\n    .catch(err => console.error('Mongoose connect(...) failed with err: ', err))\n}\n\nconnect();\n\nmongoose.set('useCreateIndex', true);\nmongoose.Promise = Promise;\n\nmongoose.connection.on('error', () => {\n  console.error('Could not connect to MongoDB')\n});\n\nmongoose.connection.on('disconnected', () => {\n  console.error('Lost MongoDB connection...')\n  if (!isConnectedBefore) {\n    setTimeout(() => connect(), RETRY_TIMEOUT)\n  }\n});\n\nmongoose.connection.on('connected', () => {\n  isConnectedBefore = true\n  console.info('Connection established to MongoDB')\n});\n\nmongoose.connection.on('reconnected', () => {\n  console.info('Reconnected to MongoDB')\n});\n\n// Close the Mongoose connection, when receiving SIGINT\nprocess.on('SIGINT', () => {\n  mongoose.connection.close(function () {\n    console.warn('Force to close the MongoDB connection after SIGINT')\n    process.exit(0)\n  })\n});\n\nglobal.pagesKeyID = new Object();\n\nconst app = express();\n\nconst bot = new Bot(process.env.FB_VERIFY_TOKEN, true);\n\n// getAllPages().then(async (pageArray) => {\n//   for (let i = 0; i < pageArray.length; i++) {\n//     const page = pageArray[i];\n//     const fields = ['greeting', 'get_started', 'persistent_menu'];\n//     bot._token = page.accessToken;\n//     const response = await bot.getFields(fields);\n//     global.pagesKeyID[page.pageID] = page.accessToken;\n\n//     console.info(`GET fields for ${page.pageID}-${page.name}:`)\n//     console.info(response);\n//   }\n// });\n\n\n// Beggining - That is all to log in the local timezone\n// https://medium.com/front-end-hacking/node-js-logs-in-local-timezone-on-morgan-and-winston-9e98b2b9ca45\n// [Node.js] Logs in Local Timezone on Morgan\nlogger.token('date', (req, res, tz) => {\n  return moment().tz(tz).format();\n})\nlogger.format('myformat', '[:date[America/Sao_Paulo]] \":method :url\" :status :res[content-length] - :response-time ms');\n\napp.use(logger(\"myformat\"));\n// End - That is all to log in the right timezone\n\napp.set('json spaces', 2);\napp.use(bodyParser.urlencoded({ extended: true }));\napp.use(bodyParser.json());\napp.use('/buckets/facebook', async (req, res, next) => {\n  let doNext = true;\n  if (req.body && req.body.object === 'page') {\n    if (req.body.entry.length > 0) {\n      try {\n        // Iterates over each entry - there may be multiple if batched\n        // for (let i = 0; i < req.body.entry.length; i++) {\n        let pageID = req.body.entry[0].id;\n        if (global.pagesKeyID[pageID] && global.pagesKeyID[pageID] !== '') {\n          req.token = global.pagesKeyID[pageID];\n        }\n        else {\n          let timerIdentifier = \"getOnePageToken\" + Math.random();\n          console.time(timerIdentifier);\n          const { accessToken, name } = await getOnePageToken(pageID);\n          req.token = accessToken;\n          console.timeEnd(timerIdentifier);\n          global.pagesKeyID[pageID] = accessToken;\n        }\n\n        // const _time = req.body.entry[0].time;\n        // const messageTime = new Date(_time).toLocaleTimeString('pt-BR');\n        // console.info(`${messageTime} From ${pageID} memory tokens:${Object.keys(global.pagesKeyID).length}`);\n\n      } catch (expressAppUseGetTokenError) {\n        console.error({ expressAppUseGetTokenError });\n      }\n    }\n  }\n  else {\n    console.log('Something came, not a page...');\n  }\n  if (doNext)\n    next();\n});\n\napp.use('/buckets/facebook', bot.router());\napp.listen(process.env.FB_WEBHOOK_PORT, () => console.log(`Bot server listening on port ${process.env.FB_WEBHOOK_PORT}`));\n\n/**\n * Event triggered when the button \"GET_STARTED\" is pressed.\n */\nbot.on('GET_STARTED', async (message) => {\n  const { sender } = message;\n  try {\n    // Send Welcome Message\n    await bot.startTyping(sender.id);\n    const out1 = await sendWelcomeMessage(sender, message.recipient.id)\n    await Bot.wait(1000);\n    await bot.stopTyping(sender.id);\n    await bot.send(sender.id, out1);\n\n    // Send Main Menu\n    await bot.startTyping(sender.id);\n    const out2 = await sendMainMenu();\n    await Bot.wait(1000);\n    await bot.stopTyping(sender.id);\n    await bot.send(sender.id, out2);\n\n  } catch (error) {\n    console.error('GET_STARTED error:', error.message);\n    const outError = await sendErrorMsg(error.message);\n    await bot.stopTyping(sender.id);\n    await bot.send(sender.id, outError);\n  }\n});\n\n// all postbacks are emitted via 'postback'\nbot.on('postback', async (event, message, data) => {\n  console.info(`postback from ${data}, you need to take care of this thing!`);\n  console.info(message);\n});\n\n// all postbacks are emitted via 'postback'\nbot.on('MAIN-MENU', async (message, data) => {\n  const { sender, recipient } = message;\n  try {\n    await bot.startTyping(sender.id);\n    if (data === 'CARDAPIO_PAYLOAD') {\n      const out = await sendCardapio(message.recipient.id);\n      await bot.stopTyping(sender.id);\n      await bot.send(sender.id, out);\n\n    } else if (data === 'PEDIDO_PAYLOAD') {\n      // Show saved address or ask for location\n      await bot.startTyping(sender.id);\n      await Bot.wait(1000);\n      const user = await bot.fetchUser(sender.id);\n      const answer = await confirmAddressOrAskLocation(recipient.id, sender.id, user);\n      await bot.stopTyping(sender.id);\n      await bot.send(sender.id, answer);\n    } else if (data === 'HORARIO_PAYLOAD') {\n      const out = await sendHorario(message.recipient.id);\n      await bot.stopTyping(sender.id);\n      await bot.send(sender.id, out);\n    }\n  } catch (mainMenuError) {\n    console.error({ mainMenuError });\n    const outError = await sendErrorMsg(mainMenuError.message);\n    await bot.stopTyping(sender.id);\n    await bot.send(sender.id, outError);\n  }\n});\n\n\n/**\n * Question No.02 (location)\n * clicked \"Fazer Pedido\"\n * gonna ask for QUANTITY\n */\nbot.on('message', async (message) => {\n  const { sender, recipient, location } = message;\n\n  try {\n    if (location) {\n      console.info({ location });\n\n      await bot.startTyping(sender.id);\n      await Bot.wait(1000);\n      const user = await bot.fetchUser(sender.id);\n      const answer = await confirmLocationAddress(recipient.id, sender.id, location, user);\n      await bot.stopTyping(sender.id);\n      await bot.send(sender.id, answer);\n    }\n    else if (message.text === 'hello' || message.text === 'hi') {\n      await bot.startTyping(sender.id);\n      await Bot.wait(1000);\n      const answer = await basicReply();\n      await bot.stopTyping(sender.id);\n      await bot.send(sender.id, answer);\n    }\n    else {\n      await bot.startTyping(sender.id);\n      await Bot.wait(1000);\n      const answer = await confirmTypedText(recipient.id, sender.id, message);\n      await bot.stopTyping(sender.id);\n      await bot.send(sender.id, answer);\n    }\n  } catch (onMessageError) {\n    console.error({ onMessageError });\n    const outError = await sendErrorMsg(onMessageError.message);\n    await bot.stopTyping(sender.id);\n    await bot.send(sender.id, outError);\n  }\n});\n\n/**\n * clicked \"Fazer Pedido\"\n * gonna ask for QUANTITY\n */\nbot.on('quick-reply', async (message, quick_reply) => {\n\n  const { sender, recipient } = message;\n  const { payload } = quick_reply;\n  try {\n    if (payload) {\n      await bot.startTyping(sender.id);\n      await Bot.wait(1000);\n      const answer = await showPhone(recipient.id, sender.id, payload);\n      await bot.stopTyping(sender.id);\n      await bot.send(sender.id, answer);\n\n      // next question\n      await bot.startTyping(sender.id);\n      await Bot.wait(1000);\n      const out = await askForQuantity(recipient.id, sender.id);\n      await bot.stopTyping(sender.id);\n      await bot.send(sender.id, out);\n    }\n  } catch (quickReplyError) {\n    console.error({ quickReplyError });\n    const outError = await sendErrorMsg(quickReplyError.message);\n    await bot.stopTyping(sender.id);\n    await bot.send(sender.id, outError);\n  }\n});\n\n/**\n * Answer No.01\n * answered CORRECT_SAVED_ADDRESS\n * gonna ask for phone\n */\nbot.on('CORRECT_SAVED_ADDRESS', async (message, data) => {\n  const { sender, recipient } = message;\n  try {\n    // show what the user chose\n    await bot.startTyping(sender.id);\n    await Bot.wait(800);\n    const answer = await showAddress(recipient.id, sender.id, data);\n    await bot.stopTyping(sender.id);\n    await bot.send(sender.id, answer);\n\n    // next question\n    await bot.startTyping(sender.id);\n    await Bot.wait(800);\n    const out = await askForPhone(recipient.id, sender.id);\n    await bot.stopTyping(sender.id);\n    await bot.send(sender.id, out);\n  } catch (error) {\n    console.error('CORRECT_SAVED_ADDRESS:', error.message);\n    const outError = await sendErrorMsg(error.message);\n    await bot.stopTyping(sender.id);\n    await bot.send(sender.id, outError);\n  }\n\n});\n\n/**\n * answered CORRECT_SAVED_ADDRESS\n * gonna ask for phone\n */\nbot.on('LOCATION_ADDRESS', async (message, data) => {\n  const { sender, recipient } = message;\n\n  try {\n    if (data === 'incorrect_address') {\n      await bot.startTyping(sender.id);\n      await Bot.wait(1000);\n      const answer = await askToTypeAddress(recipient.id, sender.id);\n      await bot.stopTyping(sender.id);\n      await bot.send(sender.id, answer);\n    }\n    else {\n      // show what the user chose\n      await bot.startTyping(sender.id);\n      await Bot.wait(1000);\n      const answer = await showAddress(recipient.id, sender.id, data);\n      await bot.stopTyping(sender.id);\n      await bot.send(sender.id, answer);\n\n      // next question\n      await bot.startTyping(sender.id);\n      await Bot.wait(1000);\n      const out = await showOrderOrAskForPhone(recipient.id, sender.id);\n      await bot.stopTyping(sender.id);\n      await bot.send(sender.id, out);\n    }\n  } catch (error) {\n    console.error('LOCATION_ADDRESS:', error.message);\n    const outError = await sendErrorMsg(error.message);\n    await bot.stopTyping(sender.id);\n    await bot.send(sender.id, outError);\n  }\n});\n\n\n/**\n * answered CORRECT_SAVED_ADDRESS\n * gonna ask for phone\n */\nbot.on('WRONG_SAVED_ADDRESS', async (message, data) => {\n  const { sender, recipient } = message;\n  try {\n    const out = await askForLocation();\n    await Bot.wait(1000);\n    await bot.stopTyping(sender.id);\n    await bot.send(sender.id, out);\n  } catch (error) {\n    console.error('WRONG_SAVED_ADDRESS:', error.message);\n    const outError = await sendErrorMsg(error.message);\n    await bot.stopTyping(sender.id);\n    await bot.send(sender.id, outError);\n  }\n});\n\nbot.on('PHONE_CONFIRMED', async (message, data) => {\n  const { sender, recipient } = message;\n  try {\n    if (data === 'change_phone') {\n      // next question\n      const out = await askToTypePhone(recipient.id, sender.id);\n      await Bot.wait(1000);\n      await bot.stopTyping(sender.id);\n      await bot.send(sender.id, out);\n    }\n    else {\n      // show what the user typed\n      await bot.startTyping(sender.id);\n      await Bot.wait(1000);\n      const answer = await showPhone(recipient.id, sender.id, data);\n      await bot.stopTyping(sender.id);\n      await bot.send(sender.id, answer);\n\n      // next question\n      await bot.startTyping(sender.id);\n      await Bot.wait(1000);\n      const out = await askForQuantity(recipient.id, sender.id);\n      await bot.stopTyping(sender.id);\n      await bot.send(sender.id, out);\n    }\n  } catch (error) {\n    console.error('PHONE_CONFIRMED:', error.message);\n    const outError = await sendErrorMsg(error.message);\n    await bot.stopTyping(sender.id);\n    await bot.send(sender.id, outError);\n  }\n\n});\n\n\n/**\n * answered ORDER_QTY\n * gonna ask for SIZE\n */\nbot.on('ORDER_QTY', async (message, data) => {\n  const { sender, recipient } = message;\n  try {\n    if (data && data === 'qty_more') {\n      await bot.startTyping(sender.id);\n      await Bot.wait(1000);\n      const out = await askForQuantityMore();\n      await bot.stopTyping(sender.id);\n      await bot.send(sender.id, out);\n    }\n    else {\n      // show what the user chose\n      await bot.startTyping(sender.id);\n      await Bot.wait(1000);\n      const answer = await showQuantity(recipient.id, sender.id, data);\n      await bot.stopTyping(sender.id);\n      await bot.send(sender.id, answer);\n      // next question\n      await bot.startTyping(sender.id);\n      await Bot.wait(1000);\n      const out = await askForSize(recipient.id, sender.id);\n      await bot.stopTyping(sender.id);\n      await bot.send(sender.id, out);\n    }\n  } catch (error) {\n    console.error('ORDER_QTY:', error.message);\n    const outError = await sendErrorMsg(error.message);\n    await bot.stopTyping(sender.id);\n    await bot.send(sender.id, outError);\n  }\n});\n\n/**\n * answered ORDER_SIZE\n * gonna ask for FLAVOR\n */\nbot.on('ORDER_SIZE', async (message, data) => {\n  const { sender, recipient } = message;\n\n  try {\n    // show what the user chose\n    await bot.startTyping(sender.id);\n    await Bot.wait(900);\n    const answer = await showSize(recipient.id, sender.id, data);\n    await bot.stopTyping(sender.id);\n    await bot.send(sender.id, answer);\n\n    // check if the size is splitable.\n    await bot.startTyping(sender.id);\n    await Bot.wait(900);\n    const out = await askForSplitFlavorOrConfirm(message.recipient.id, sender.id, 1);\n    await bot.stopTyping(sender.id);\n    await bot.send(sender.id, out);\n\n  } catch (error) {\n    console.error('ORDER_SIZE:', error.message);\n    const outError = await sendErrorMsg(error.message);\n    await bot.stopTyping(sender.id);\n    await bot.send(sender.id, outError);\n  }\n});\n\n\nbot.on('ORDER_SPLIT', async (message, data) => {\n  const { sender, recipient } = message;\n\n  await bot.startTyping(sender.id);\n  await Bot.wait(900);\n  const answer = await showSplit(recipient.id, sender.id, data);\n  await bot.stopTyping(sender.id);\n  await bot.send(sender.id, answer);\n\n  const split = Number(data);\n\n  // next question\n  await bot.startTyping(sender.id);\n  await Bot.wait(500);\n  const out = await askForFlavorOrConfirm(message.recipient.id, sender.id, 1, split);\n  await bot.stopTyping(sender.id);\n  await bot.send(sender.id, out);\n});\n\n/**\n * answered ORDER_FLAVOR\n * gonna ask for confirmation\n */\nbot.on('ORDER_FLAVOR', async (message, data) => {\n  const { sender, recipient } = message;\n  try {\n    if (data && data.option && data.option === 'flavors_more') {\n      // next question\n      await bot.startTyping(sender.id);\n      await Bot.wait(500);\n      const out = await askForFlavor(message.recipient.id, sender.id, data.multiple);\n      await bot.stopTyping(sender.id);\n      await bot.send(sender.id, out);\n    }\n    else {\n      // show what the user chose\n      await bot.startTyping(sender.id);\n      await Bot.wait(900);\n      const answer = await showFlavor(recipient.id, sender.id, data);\n      await bot.stopTyping(sender.id);\n      await bot.send(sender.id, answer);\n\n      // show summary\n      await bot.startTyping(sender.id);\n      await Bot.wait(1000);\n      const summary = await showOrderOrNextItem(recipient.id, sender.id);\n      await bot.stopTyping(sender.id);\n      await bot.send(sender.id, summary);\n    }\n  } catch (error) {\n    console.error('ORDER_FLAVOR:', error.message);\n    const outError = await sendErrorMsg(error.message);\n    await bot.stopTyping(sender.id);\n    await bot.send(sender.id, outError);\n  }\n});\n\n\n/**\n * answered ORDER_CONFIRMATION\n */\nbot.on('ORDER_CONFIRMATION', async (message, data) => {\n  const { sender, recipient } = message;\n\n  try {\n    if (data === 'confirmation_yes') {\n      await bot.startTyping(sender.id);\n      await Bot.wait(1000);\n      const out = await confirmOrder(recipient.id, sender.id);\n      await bot.stopTyping(sender.id);\n      await bot.send(sender.id, out);\n      delete global.pagesKeyID[recipient.id];\n    }\n    else if (data === 'confirmation_no') {\n      await bot.startTyping(sender.id);\n      await Bot.wait(1000);\n      const out = await askForChangeOrder(recipient.id, sender.id);\n      await bot.stopTyping(sender.id);\n      await bot.send(sender.id, out);\n    }\n  } catch (orderConfirmationError) {\n    console.error({ orderConfirmationError });\n    const outError = await sendErrorMsg(orderConfirmationError.message);\n    await bot.stopTyping(sender.id);\n    await bot.send(sender.id, outError);\n  }\n\n});\n\n/**\n * answered wants change something in the order\n */\nbot.on('ORDER_WANT_CHANGE', async (message, data) => {\n  const { sender, recipient } = message;\n\n  try {\n    await bot.startTyping(sender.id);\n    await Bot.wait(1000);\n    const out = await askForSpecificItem(recipient.id, sender.id);\n    await bot.stopTyping(sender.id);\n    await bot.send(sender.id, out);\n  } catch (error) {\n    console.error('ORDER_WANT_CHANGE:', error.message);\n    const outError = await sendErrorMsg(error.message);\n    await bot.stopTyping(sender.id);\n    await bot.send(sender.id, outError);\n  }\n\n});\n\nbot.on('ORDER_CHANGE', async (message, data) => {\n  const { sender, recipient } = message;\n\n  try {\n    await bot.startTyping(sender.id);\n    await Bot.wait(500);\n    let out;\n    if (data === 'change_quantity') {\n      out = await askForQuantity(recipient.id, sender.id);\n    }\n    else if (data === 'change_size') {\n      out = await askForSize(recipient.id, sender.id);\n    }\n    else if (data === 'change_flavor') {\n      out = await askForFlavor(message.recipient.id, sender.id, 1);\n    }\n    else if (data === 'change_address') {\n      out = await askForLocation();\n    }\n    await bot.stopTyping(sender.id);\n    await bot.send(sender.id, out);\n  } catch (error) {\n    console.error('ORDER_CHANGE:', error.message);\n    const outError = await sendErrorMsg(error.message);\n    await bot.stopTyping(sender.id);\n    await bot.send(sender.id, outError);\n  }\n});\n\nbot.on('ORDER_CHANGE_SELECT_ITEM', async (message, data) => {\n  const { sender, recipient } = message;\n  try {\n    await bot.startTyping(sender.id);\n    await Bot.wait(1000);\n    const out = await updateItemAskOptions(recipient.id, sender.id, data);\n    await bot.stopTyping(sender.id);\n    await bot.send(sender.id, out);\n  } catch (error) {\n    console.error('ORDER_CHANGE_SELECT_ITEM:', error.message);\n    const outError = await sendErrorMsg(error.message);\n    await bot.stopTyping(sender.id);\n    await bot.send(sender.id, outError);\n  }\n});\n\n\n"],"file":"server-bot.js"}